<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Game
Description : Game main and SDL loops
-}</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Game</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">FRP.Yampa</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Linear</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Linear.Metric</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">threadDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C.Types</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">SDL</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">SDL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">($=)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Point</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Rectangle</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">SDL.Font</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SFont</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock.POSIX</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getPOSIXTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="ObjectsLoader.html"><span class="hs-identifier">ObjectsLoader</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="SDLWrapper.html"><span class="hs-identifier">SDLWrapper</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Parser.html"><span class="hs-identifier">Parser</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.html"><span class="hs-identifier">Types</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GameController.html"><span class="hs-identifier">GameController</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Constants.html"><span class="hs-identifier">Constants</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">-- |Main is supposed to initialize all IO (create SDL Window, create Renderer, load maps and scores from files) and then start reactimate loop</span><span>
</span><span id="line-31"></span><span class="annot"><a href="Game.html#main"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span id="main"><span class="annot"><span class="annottext">main :: IO ()
</span><a href="Game.html#main"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="annottext">IO ()
forall (m :: * -&gt; *). (Functor m, MonadIO m) =&gt; m ()
</span><span class="hs-identifier hs-var">SDL.initializeAll</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="annottext">IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; m ()
</span><span class="hs-identifier hs-var">SFont.initialize</span></span><span>
</span><span id="line-35"></span><span>  </span><span id="local-6989586621679216519"><span class="annot"><span class="annottext">Font
</span><a href="#local-6989586621679216519"><span class="hs-identifier hs-var">font</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; PointSize -&gt; IO Font
forall (m :: * -&gt; *). MonadIO m =&gt; FilePath -&gt; PointSize -&gt; m Font
</span><span class="hs-identifier hs-var">SFont.load</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Constants.html#fontPath"><span class="hs-identifier hs-var">fontPath</span></a></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="annottext">Hint RenderScaleQuality
</span><span class="hs-identifier hs-var">SDL.HintRenderScaleQuality</span></span><span> </span><span class="annot"><span class="annottext">Hint RenderScaleQuality -&gt; RenderScaleQuality -&gt; IO ()
forall t a (m :: * -&gt; *).
(HasSetter t a, MonadIO m) =&gt;
t -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">$=</span></span><span> </span><span class="annot"><span class="annottext">RenderScaleQuality
</span><span class="hs-identifier hs-var">SDL.ScaleLinear</span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>  </span><span id="local-6989586621679216514"><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679216514"><span class="hs-identifier hs-var">window</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; WindowConfig -&gt; IO Window
forall (m :: * -&gt; *). MonadIO m =&gt; Text -&gt; WindowConfig -&gt; m Window
</span><span class="hs-identifier hs-var">SDL.createWindow</span></span><span>
</span><span id="line-40"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Constants.html#windowName"><span class="hs-identifier hs-var">windowName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>      </span><span class="annot"><span class="annottext">WindowConfig
</span><span class="hs-identifier hs-var">SDL.defaultWindow</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">windowInitialSize :: V2 CInt
</span><span class="hs-identifier hs-var">SDL.windowInitialSize</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; V2 CInt
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Constants.html#initScreenWidth"><span class="hs-identifier hs-var">initScreenWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Constants.html#initScreenHeight"><span class="hs-identifier hs-var">initScreenHeight</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="annottext">Window -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Window -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.showWindow</span></span><span> </span><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679216514"><span class="hs-identifier hs-var">window</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>  </span><span id="local-6989586621679216505"><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216505"><span class="hs-identifier hs-var">renderer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="annottext">Window -&gt; CInt -&gt; RendererConfig -&gt; IO Renderer
forall (m :: * -&gt; *).
MonadIO m =&gt;
Window -&gt; CInt -&gt; RendererConfig -&gt; m Renderer
</span><span class="hs-identifier hs-var">SDL.createRenderer</span></span><span>
</span><span id="line-46"></span><span>      </span><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679216514"><span class="hs-identifier hs-var">window</span></a></span><span>
</span><span id="line-47"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>      </span><span class="annot"><span class="annottext">RendererConfig :: RendererType -&gt; Bool -&gt; RendererConfig
</span><span class="hs-identifier hs-type hs-type">SDL.RendererConfig</span></span><span>
</span><span id="line-49"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rendererType :: RendererType
</span><span class="hs-identifier hs-var">SDL.rendererType</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RendererType
</span><span class="hs-identifier hs-var">SDL.SoftwareRenderer</span></span><span>
</span><span id="line-50"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rendererTargetTexture :: Bool
</span><span class="hs-identifier hs-var">SDL.rendererTargetTexture</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-51"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="annottext">Window -&gt; StateVar Bool
</span><span class="hs-identifier hs-var">SDL.windowGrab</span></span><span> </span><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679216514"><span class="hs-identifier hs-var">window</span></a></span><span> </span><span class="annot"><span class="annottext">StateVar Bool -&gt; Bool -&gt; IO ()
forall t a (m :: * -&gt; *).
(HasSetter t a, MonadIO m) =&gt;
t -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">$=</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-53"></span><span>  </span><span id="local-6989586621679216497"><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216497"><span class="hs-identifier hs-var">spriteSheetTexture</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Renderer -&gt; FilePath -&gt; IO Texture
</span><a href="SDLWrapper.html#loadTexture"><span class="hs-identifier hs-var">loadTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216505"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Constants.html#spriteSheetPath"><span class="hs-identifier hs-var">spriteSheetPath</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621679216494"><span class="annot"><span class="annottext">[ObjsMap]
</span><a href="#local-6989586621679216494"><span class="hs-identifier hs-var">staticObjs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CInt, CInt) -&gt; FilePath -&gt; IO [ObjsMap]
</span><a href="ObjectsLoader.html#prepareStaticObjsMap"><span class="hs-identifier hs-var">prepareStaticObjsMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt
</span><a href="Constants.html#initTileWidth"><span class="hs-identifier hs-var">initTileWidth</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Constants.html#initTileHeight"><span class="hs-identifier hs-var">initTileHeight</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Constants.html#mapsPath"><span class="hs-identifier hs-var">mapsPath</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span id="local-6989586621679216489"><span class="annot"><span class="annottext">[[DynamicGameObj]]
</span><a href="#local-6989586621679216489"><span class="hs-identifier hs-var">dynamicObjs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PointSize -&gt; IO [[DynamicGameObj]]
</span><a href="ObjectsLoader.html#prepareDynamicObjs"><span class="hs-identifier hs-var">prepareDynamicObjs</span></a></span><span> </span><span class="annot"><span class="annottext">(PointSize -&gt; IO [[DynamicGameObj]])
-&gt; PointSize -&gt; IO [[DynamicGameObj]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ObjsMap] -&gt; PointSize
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; PointSize
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ObjsMap]
</span><a href="#local-6989586621679216494"><span class="hs-identifier hs-var">staticObjs</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span id="local-6989586621679216486"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679216486"><span class="hs-identifier hs-var">scoresFilesPaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO [FilePath]
</span><a href="ObjectsLoader.html#prepareScoresFiles"><span class="hs-identifier hs-var">prepareScoresFiles</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Constants.html#mapsPath"><span class="hs-identifier hs-var">mapsPath</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span id="local-6989586621679216484"><span class="annot"><span class="annottext">[[PointSize]]
</span><a href="#local-6989586621679216484"><span class="hs-identifier hs-var">scores</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO [PointSize]) -&gt; [FilePath] -&gt; IO [[PointSize]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679216482"><span class="annot"><span class="annottext">filePath :: FilePath
</span><a href="#local-6989586621679216482"><span class="hs-identifier hs-var">filePath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IOMode -&gt; (Handle -&gt; IO [FilePath]) -&gt; IO [FilePath]
forall r. FilePath -&gt; IOMode -&gt; (Handle -&gt; IO r) -&gt; IO r
</span><span class="hs-identifier hs-var">withFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679216482"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadMode</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO FilePath -&gt; IO [FilePath]
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f [a]
</span><span class="hs-identifier hs-var">many</span></span><span> </span><span class="annot"><span class="annottext">(IO FilePath -&gt; IO [FilePath])
-&gt; (Handle -&gt; IO FilePath) -&gt; Handle -&gt; IO [FilePath]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO FilePath
</span><span class="hs-identifier hs-var">hGetLine</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO [FilePath] -&gt; ([FilePath] -&gt; IO [PointSize]) -&gt; IO [PointSize]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PointSize] -&gt; IO [PointSize]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([PointSize] -&gt; IO [PointSize])
-&gt; ([FilePath] -&gt; [PointSize]) -&gt; [FilePath] -&gt; IO [PointSize]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PointSize -&gt; [PointSize] -&gt; [PointSize]
forall a. PointSize -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">([PointSize] -&gt; [PointSize])
-&gt; ([FilePath] -&gt; [PointSize]) -&gt; [FilePath] -&gt; [PointSize]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[PointSize] -&gt; [PointSize]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sort</span></span><span> </span><span class="annot"><span class="annottext">([PointSize] -&gt; [PointSize])
-&gt; ([FilePath] -&gt; [PointSize]) -&gt; [FilePath] -&gt; [PointSize]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; PointSize) -&gt; [FilePath] -&gt; [PointSize]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; PointSize
forall a. Read a =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679216486"><span class="hs-identifier hs-var">scoresFilesPaths</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="annottext">IO GameInput
-&gt; (Bool -&gt; IO (DTime, Maybe GameInput))
-&gt; (Bool -&gt; GameOutput -&gt; IO Bool)
-&gt; SF GameInput GameOutput
-&gt; IO ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m a
-&gt; (Bool -&gt; m (DTime, Maybe a))
-&gt; (Bool -&gt; b -&gt; m Bool)
-&gt; SF a b
-&gt; m ()
</span><span class="hs-identifier hs-var">reactimate</span></span><span> </span><span class="annot"><span class="annottext">IO GameInput
</span><a href="Parser.html#parseInput"><span class="hs-identifier hs-var">parseInput</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO GameInput
</span><a href="Parser.html#parseInput"><span class="hs-identifier hs-var">parseInput</span></a></span><span> </span><span class="annot"><span class="annottext">IO GameInput
-&gt; (GameInput -&gt; IO (DTime, Maybe GameInput))
-&gt; IO (DTime, Maybe GameInput)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679216470"><span class="annot"><span class="annottext">gi :: GameInput
</span><a href="#local-6989586621679216470"><span class="hs-identifier hs-var">gi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DTime, Maybe GameInput) -&gt; IO (DTime, Maybe GameInput)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTime
</span><a href="Constants.html#simulationRate"><span class="hs-identifier hs-var">simulationRate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GameInput -&gt; Maybe GameInput
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GameInput
</span><a href="#local-6989586621679216470"><span class="hs-identifier hs-var">gi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- we parse input (using SDL) and give it to the controller</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679216468"><span class="annot"><span class="annottext">output :: GameOutput
</span><a href="#local-6989586621679216468"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Renderer
-&gt; Texture
-&gt; [[PointSize]]
-&gt; [FilePath]
-&gt; [ObjsMap]
-&gt; Font
-&gt; GameOutput
-&gt; IO Bool
</span><a href="Game.html#appLoop"><span class="hs-identifier hs-var">appLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216505"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216497"><span class="hs-identifier hs-var">spriteSheetTexture</span></a></span><span> </span><span class="annot"><span class="annottext">[[PointSize]]
</span><a href="#local-6989586621679216484"><span class="hs-identifier hs-var">scores</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679216486"><span class="hs-identifier hs-var">scoresFilesPaths</span></a></span><span> </span><span class="annot"><span class="annottext">[ObjsMap]
</span><a href="#local-6989586621679216494"><span class="hs-identifier hs-var">staticObjs</span></a></span><span> </span><span class="annot"><span class="annottext">Font
</span><a href="#local-6989586621679216519"><span class="hs-identifier hs-var">font</span></a></span><span> </span><span class="annot"><span class="annottext">GameOutput
</span><a href="#local-6989586621679216468"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- given GameController output, we go into SDL loop</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ball -&gt; GameInfo -&gt; SF GameInput GameOutput
</span><a href="GameController.html#gameController"><span class="hs-identifier hs-var">gameController</span></a></span><span> </span><span class="annot"><span class="annottext">Ball
</span><a href="Constants.html#startBall"><span class="hs-identifier hs-var">startBall</span></a></span><span> </span><span class="annot"><span class="annottext">GameInfo :: CInt
-&gt; CInt
-&gt; CInt
-&gt; CInt
-&gt; [ObjsMap]
-&gt; [[DynamicGameObj]]
-&gt; PointSize
-&gt; GameInfo
</span><a href="Types.html#GameInfo"><span class="hs-identifier hs-type hs-type">GameInfo</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-62"></span><span>                              </span><span class="annot"><span class="annottext">screenWidth :: CInt
</span><a href="Types.html#screenWidth"><span class="hs-identifier hs-var">screenWidth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Constants.html#initScreenWidth"><span class="hs-identifier hs-var">initScreenWidth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>                              </span><span class="annot"><span class="annottext">screenHeight :: CInt
</span><a href="Types.html#screenHeight"><span class="hs-identifier hs-var">screenHeight</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Constants.html#initScreenHeight"><span class="hs-identifier hs-var">initScreenHeight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>                              </span><span class="annot"><span class="annottext">tileWidth :: CInt
</span><a href="Types.html#tileWidth"><span class="hs-identifier hs-var">tileWidth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Constants.html#initTileWidth"><span class="hs-identifier hs-var">initTileWidth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>                              </span><span class="annot"><span class="annottext">tileHeight :: CInt
</span><a href="Types.html#tileHeight"><span class="hs-identifier hs-var">tileHeight</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Constants.html#initTileHeight"><span class="hs-identifier hs-var">initTileHeight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>                              </span><span class="annot"><span class="annottext">staticObjsMap :: [ObjsMap]
</span><a href="Types.html#staticObjsMap"><span class="hs-identifier hs-var">staticObjsMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ObjsMap]
</span><a href="#local-6989586621679216494"><span class="hs-identifier hs-var">staticObjs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>                              </span><span class="annot"><span class="annottext">dynamicObjsInfo :: [[DynamicGameObj]]
</span><a href="Types.html#dynamicObjsInfo"><span class="hs-identifier hs-var">dynamicObjsInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[DynamicGameObj]]
</span><a href="#local-6989586621679216489"><span class="hs-identifier hs-var">dynamicObjs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>                              </span><span class="annot"><span class="annottext">currLvl :: PointSize
</span><a href="Types.html#currLvl"><span class="hs-identifier hs-var">currLvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-69"></span><span>                              </span><span class="hs-special">}</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">Renderer -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Renderer -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.destroyRenderer</span></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216505"><span class="hs-identifier hs-var">renderer</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="annottext">Window -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Window -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.destroyWindow</span></span><span> </span><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679216514"><span class="hs-identifier hs-var">window</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; m ()
</span><span class="hs-identifier hs-var">SDL.quit</span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- |appLoop is responsible for displaying game state with SDL and managing IO when needed (for example: saving score)</span><span>
</span><span id="line-77"></span><span class="annot"><a href="Game.html#appLoop"><span class="hs-identifier hs-type">appLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SDL.Renderer</span></span><span>   </span><span class="hs-comment">-- ^ Renderer used</span><span>
</span><span id="line-78"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#Texture"><span class="hs-identifier hs-type">Texture</span></a></span><span>      </span><span class="hs-comment">-- ^ Sprite sheet</span><span>
</span><span id="line-79"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ Highscores for each level</span><span>
</span><span id="line-80"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ Filepaths for scores to write to</span><span>
</span><span id="line-81"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ Map of game objects with positions as keys</span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SFont.Font</span></span><span>   </span><span class="hs-comment">-- ^ Font used to write game info on screen</span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#GameOutput"><span class="hs-identifier hs-type">GameOutput</span></a></span><span>   </span><span class="hs-comment">-- ^ Yampa ouput which gives us gamestate info</span><span>
</span><span id="line-84"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- ^ Should we finish our loop?</span><span>
</span><span id="line-85"></span><span id="appLoop"><span class="annot"><span class="annottext">appLoop :: Renderer
-&gt; Texture
-&gt; [[PointSize]]
-&gt; [FilePath]
-&gt; [ObjsMap]
-&gt; Font
-&gt; GameOutput
-&gt; IO Bool
</span><a href="Game.html#appLoop"><span class="hs-identifier hs-var hs-var">appLoop</span></a></span></span><span> </span><span id="local-6989586621679216452"><span class="annot"><span class="annottext">renderer :: Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span></span><span> </span><span id="local-6989586621679216451"><span class="annot"><span class="annottext">sheet :: Texture
</span><a href="#local-6989586621679216451"><span class="hs-identifier hs-var">sheet</span></a></span></span><span> </span><span id="local-6989586621679216450"><span class="annot"><span class="annottext">scores :: [[PointSize]]
</span><a href="#local-6989586621679216450"><span class="hs-identifier hs-var">scores</span></a></span></span><span> </span><span id="local-6989586621679216449"><span class="annot"><span class="annottext">scoresPaths :: [FilePath]
</span><a href="#local-6989586621679216449"><span class="hs-identifier hs-var">scoresPaths</span></a></span></span><span> </span><span id="local-6989586621679216448"><span class="annot"><span class="annottext">objsMap :: [ObjsMap]
</span><a href="#local-6989586621679216448"><span class="hs-identifier hs-var">objsMap</span></a></span></span><span> </span><span id="local-6989586621679216447"><span class="annot"><span class="annottext">font :: Font
</span><a href="#local-6989586621679216447"><span class="hs-identifier hs-var">font</span></a></span></span><span> </span><span id="local-6989586621679216446"><span class="annot"><span class="annottext">go :: GameOutput
</span><a href="#local-6989586621679216446"><span class="hs-identifier hs-var">go</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameOutput"><span class="hs-identifier hs-type">GameOutput</span></a></span><span> </span><span id="local-6989586621679216444"><span class="annot"><span class="annottext">b :: Ball
</span><a href="#local-6989586621679216444"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Ball"><span class="hs-identifier hs-type">Ball</span></a></span><span> </span><span id="local-6989586621679216442"><span class="annot"><span class="annottext">p :: Point V2 DTime
</span><a href="#local-6989586621679216442"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span id="local-6989586621679216440"><span class="annot"><span class="annottext">pV2 :: V2 DTime
</span><a href="#local-6989586621679216440"><span class="hs-identifier hs-var">pV2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679216439"><span class="annot"><span class="annottext">px :: DTime
</span><a href="#local-6989586621679216439"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679216438"><span class="annot"><span class="annottext">py :: DTime
</span><a href="#local-6989586621679216438"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216437"><span class="annot"><span class="annottext">v :: V2 DTime
</span><a href="#local-6989586621679216437"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679216436"><span class="annot"><span class="annottext">vx :: DTime
</span><a href="#local-6989586621679216436"><span class="hs-identifier hs-var">vx</span></a></span></span><span> </span><span id="local-6989586621679216435"><span class="annot"><span class="annottext">vy :: DTime
</span><a href="#local-6989586621679216435"><span class="hs-identifier hs-var">vy</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216434"><span class="annot"><span class="annottext">a :: V2 DTime
</span><a href="#local-6989586621679216434"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679216433"><span class="annot"><span class="annottext">ax :: DTime
</span><a href="#local-6989586621679216433"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621679216432"><span class="annot"><span class="annottext">ay :: DTime
</span><a href="#local-6989586621679216432"><span class="hs-identifier hs-var">ay</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216431"><span class="annot"><span class="annottext">r :: DTime
</span><a href="#local-6989586621679216431"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679216430"><span class="annot"><span class="annottext">pow :: DTime
</span><a href="#local-6989586621679216430"><span class="hs-identifier hs-var">pow</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216429"><span class="annot"><span class="annottext">end :: Bool
</span><a href="#local-6989586621679216429"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621679216428"><span class="annot"><span class="annottext">nshots :: PointSize
</span><a href="#local-6989586621679216428"><span class="hs-identifier hs-var">nshots</span></a></span></span><span> </span><span id="local-6989586621679216427"><span class="annot"><span class="annottext">didwin :: Bool
</span><a href="#local-6989586621679216427"><span class="hs-identifier hs-var">didwin</span></a></span></span><span> </span><span id="local-6989586621679216426"><span class="annot"><span class="annottext">didfinish :: Bool
</span><a href="#local-6989586621679216426"><span class="hs-identifier hs-var">didfinish</span></a></span></span><span> </span><span id="local-6989586621679216425"><span class="annot"><span class="annottext">lvl :: PointSize
</span><a href="#local-6989586621679216425"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679216424"><span class="annot"><span class="annottext">objs :: ObjsMap
</span><a href="#local-6989586621679216424"><span class="hs-identifier hs-var">objs</span></a></span></span><span> </span><span id="local-6989586621679216423"><span class="annot"><span class="annottext">outtime :: Integer
</span><a href="#local-6989586621679216423"><span class="hs-identifier hs-var">outtime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>  </span><span id="local-6989586621679216422"><span class="annot"><span class="annottext">mousePos :: Point V2 CInt
</span><a href="#local-6989586621679216422"><span class="hs-identifier hs-var">mousePos</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span id="local-6989586621679216421"><span class="annot"><span class="annottext">mV2 :: V2 CInt
</span><a href="#local-6989586621679216421"><span class="hs-identifier hs-var">mV2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Point V2 CInt)
forall (m :: * -&gt; *). MonadIO m =&gt; m (Point V2 CInt)
</span><span class="hs-identifier hs-var">SDL.getAbsoluteMouseLocation</span></span><span> </span><span class="hs-comment">-- we'll need mouse position to draw Power line</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679216419"><span class="annot"><span class="annottext">textColor :: V4 Word8
</span><a href="#local-6989586621679216419"><span class="hs-identifier hs-var hs-var">textColor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; V4 Word8
forall a. a -&gt; a -&gt; a -&gt; a -&gt; V4 a
</span><span class="hs-identifier hs-var">V4</span></span><span> </span><span class="annot"><span class="hs-number">255</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><span class="annottext">Renderer -&gt; StateVar (V4 Word8)
</span><span class="hs-identifier hs-var">SDL.rendererDrawColor</span></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">StateVar (V4 Word8) -&gt; V4 Word8 -&gt; IO ()
forall t a (m :: * -&gt; *).
(HasSetter t a, MonadIO m) =&gt;
t -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">$=</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; V4 Word8
forall a. a -&gt; a -&gt; a -&gt; a -&gt; V4 a
</span><span class="hs-identifier hs-var">V4</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><span class="annottext">Renderer -&gt; IO ()
forall (m :: * -&gt; *). (Functor m, MonadIO m) =&gt; Renderer -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.clear</span></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><span class="annottext">Renderer
-&gt; Texture -&gt; Point V2 CInt -&gt; Maybe (Rectangle CInt) -&gt; IO ()
</span><a href="SDLWrapper.html#renderTexture"><span class="hs-identifier hs-var">renderTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216451"><span class="hs-identifier hs-var">sheet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 CInt -&gt; Point V2 CInt
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">SDL.P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; V2 CInt
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTime -&gt; CInt
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTime
</span><a href="#local-6989586621679216439"><span class="hs-identifier hs-var">px</span></a></span><span class="annot"><span class="annottext">DTime -&gt; DTime -&gt; DTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTime
</span><a href="#local-6989586621679216431"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">DTime -&gt; DTime -&gt; DTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTime -&gt; CInt
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTime
</span><a href="#local-6989586621679216438"><span class="hs-identifier hs-var">py</span></a></span><span class="annot"><span class="annottext">DTime -&gt; DTime -&gt; DTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTime
</span><a href="#local-6989586621679216431"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">DTime -&gt; DTime -&gt; DTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rectangle CInt -&gt; Maybe (Rectangle CInt)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Rectangle CInt
</span><a href="Constants.html#ballClip"><span class="hs-identifier hs-var">ballClip</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- draw Ball</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679216411"><span class="hs-identifier hs-var">drawObjs</span></a></span><span> </span><span class="hs-comment">-- draw game objects</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="annottext">Renderer -&gt; StateVar (V4 Word8)
</span><span class="hs-identifier hs-var">SDL.rendererDrawColor</span></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">StateVar (V4 Word8) -&gt; V4 Word8 -&gt; IO ()
forall t a (m :: * -&gt; *).
(HasSetter t a, MonadIO m) =&gt;
t -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">$=</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; V4 Word8
forall a. a -&gt; a -&gt; a -&gt; a -&gt; V4 a
</span><span class="hs-identifier hs-var">V4</span></span><span> </span><span class="annot"><span class="hs-number">255</span></span><span> </span><span class="annot"><span class="hs-number">255</span></span><span> </span><span class="annot"><span class="hs-number">255</span></span><span> </span><span class="annot"><span class="hs-number">255</span></span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="annottext">Renderer -&gt; Point V2 CInt -&gt; Point V2 CInt -&gt; IO ()
forall (m :: * -&gt; *).
(Functor m, MonadIO m) =&gt;
Renderer -&gt; Point V2 CInt -&gt; Point V2 CInt -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.drawLine</span></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 CInt -&gt; Point V2 CInt
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DTime -&gt; CInt) -&gt; V2 DTime -&gt; V2 CInt
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DTime -&gt; CInt
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">V2 DTime
</span><a href="#local-6989586621679216409"><span class="hs-identifier hs-var">startDir</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 CInt -&gt; Point V2 CInt
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DTime -&gt; CInt) -&gt; V2 DTime -&gt; V2 CInt
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DTime -&gt; CInt
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">V2 DTime
</span><a href="#local-6989586621679216409"><span class="hs-identifier hs-var">startDir</span></a></span><span> </span><span class="annot"><span class="annottext">V2 CInt -&gt; V2 CInt -&gt; V2 CInt
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">V2 CInt -&gt; V2 CInt
</span><a href="#local-6989586621679216408"><span class="hs-identifier hs-var">lineEnd</span></a></span><span> </span><span class="annot"><span class="annottext">V2 CInt
</span><a href="#local-6989586621679216421"><span class="hs-identifier hs-var">mV2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- draw white line of Power</span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679216407"><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216407"><span class="hs-identifier hs-var">shotsText</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Renderer -&gt; Font -&gt; FilePath -&gt; V4 Word8 -&gt; IO Texture
</span><a href="SDLWrapper.html#loadTextTexture"><span class="hs-identifier hs-var">loadTextTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Font
</span><a href="#local-6989586621679216447"><span class="hs-identifier hs-var">font</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Number of shots:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">PointSize -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PointSize
</span><a href="#local-6989586621679216428"><span class="hs-identifier hs-var">nshots</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">V4 Word8
</span><a href="#local-6989586621679216419"><span class="hs-identifier hs-var">textColor</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621679216404"><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216404"><span class="hs-identifier hs-var">lvlText</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Renderer -&gt; Font -&gt; FilePath -&gt; V4 Word8 -&gt; IO Texture
</span><a href="SDLWrapper.html#loadTextTexture"><span class="hs-identifier hs-var">loadTextTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Font
</span><a href="#local-6989586621679216447"><span class="hs-identifier hs-var">font</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Level:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">PointSize -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PointSize
</span><a href="#local-6989586621679216425"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">V4 Word8
</span><a href="#local-6989586621679216419"><span class="hs-identifier hs-var">textColor</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621679216403"><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216403"><span class="hs-identifier hs-var">scoresText</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Renderer -&gt; Font -&gt; FilePath -&gt; V4 Word8 -&gt; IO Texture
</span><a href="SDLWrapper.html#loadTextTexture"><span class="hs-identifier hs-var">loadTextTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Font
</span><a href="#local-6989586621679216447"><span class="hs-identifier hs-var">font</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;High scores: &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PointSize] -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[PointSize]]
</span><a href="#local-6989586621679216450"><span class="hs-identifier hs-var">scores</span></a></span><span> </span><span class="annot"><span class="annottext">[[PointSize]] -&gt; PointSize -&gt; [PointSize]
forall a. [a] -&gt; PointSize -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">PointSize
</span><a href="#local-6989586621679216425"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">V4 Word8
</span><a href="#local-6989586621679216419"><span class="hs-identifier hs-var">textColor</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="annottext">Renderer
-&gt; Texture -&gt; Point V2 CInt -&gt; Maybe (Rectangle CInt) -&gt; IO ()
</span><a href="SDLWrapper.html#renderTexture"><span class="hs-identifier hs-var">renderTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216407"><span class="hs-identifier hs-var">shotsText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 CInt -&gt; Point V2 CInt
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; V2 CInt
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="hs-number">100</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Rectangle CInt)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="annottext">Renderer
-&gt; Texture -&gt; Point V2 CInt -&gt; Maybe (Rectangle CInt) -&gt; IO ()
</span><a href="SDLWrapper.html#renderTexture"><span class="hs-identifier hs-var">renderTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216404"><span class="hs-identifier hs-var">lvlText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 CInt -&gt; Point V2 CInt
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; V2 CInt
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="hs-number">150</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Rectangle CInt)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><span class="annottext">Renderer
-&gt; Texture -&gt; Point V2 CInt -&gt; Maybe (Rectangle CInt) -&gt; IO ()
</span><a href="SDLWrapper.html#renderTexture"><span class="hs-identifier hs-var">renderTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216403"><span class="hs-identifier hs-var">scoresText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 CInt -&gt; Point V2 CInt
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; V2 CInt
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="hs-number">200</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Rectangle CInt)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="annottext">Texture -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Texture -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.destroyTexture</span></span><span> </span><span class="annot"><span class="annottext">(Texture -&gt; IO ()) -&gt; Texture -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Texture -&gt; Texture
</span><a href="Types.html#texture"><span class="hs-identifier hs-var hs-var">texture</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216407"><span class="hs-identifier hs-var">shotsText</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="annottext">Texture -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Texture -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.destroyTexture</span></span><span> </span><span class="annot"><span class="annottext">(Texture -&gt; IO ()) -&gt; Texture -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Texture -&gt; Texture
</span><a href="Types.html#texture"><span class="hs-identifier hs-var hs-var">texture</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216404"><span class="hs-identifier hs-var">lvlText</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">Texture -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Texture -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.destroyTexture</span></span><span> </span><span class="annot"><span class="annottext">(Texture -&gt; IO ()) -&gt; Texture -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Texture -&gt; Texture
</span><a href="Types.html#texture"><span class="hs-identifier hs-var hs-var">texture</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216403"><span class="hs-identifier hs-var">scoresText</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679216427"><span class="hs-identifier hs-var">didwin</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">appendFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679216449"><span class="hs-identifier hs-var">scoresPaths</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; PointSize -&gt; FilePath
forall a. [a] -&gt; PointSize -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">PointSize
</span><a href="#local-6989586621679216425"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PointSize -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PointSize
</span><a href="#local-6989586621679216428"><span class="hs-identifier hs-var">nshots</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- if we finished level: append score to file</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679216426"><span class="hs-identifier hs-var">didfinish</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="annottext">Maybe Window -&gt; MessageKind -&gt; Text -&gt; Text -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
Maybe Window -&gt; MessageKind -&gt; Text -&gt; Text -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.showSimpleMessageBox</span></span><span> </span><span class="annot"><span class="annottext">Maybe Window
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">MessageKind
</span><span class="hs-identifier hs-var">SDL.Information</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Gra pokonana!&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Gratulacje! Przeszed&#322;e&#347; wszystkie poziomy.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><span class="annottext">Renderer -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Renderer -&gt; m ()
</span><span class="hs-identifier hs-var">SDL.present</span></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span id="local-6989586621679216395"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679216395"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; Integer
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; Integer)
-&gt; (POSIXTime -&gt; POSIXTime) -&gt; POSIXTime -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="hs-number">1000000</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; Integer) -&gt; IO POSIXTime -&gt; IO Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO POSIXTime
</span><span class="hs-identifier hs-var">getPOSIXTime</span></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">PointSize -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">2000</span></span><span> </span><span class="annot"><span class="annottext">PointSize -&gt; PointSize -&gt; PointSize
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; PointSize
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679216395"><span class="hs-identifier hs-var">time</span></a></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679216423"><span class="hs-identifier hs-var">outtime</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- game is supposed to work in 500 fps. if our frame did not last for</span><span>
</span><span id="line-112"></span><span>                                                       </span><span class="hs-comment">-- 2 miliseconds, we shall wait. </span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679216429"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>      </span><span id="local-6989586621679216409"><span class="annot"><span class="annottext">startDir :: V2 DTime
</span><a href="#local-6989586621679216409"><span class="hs-identifier hs-var hs-var">startDir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 DTime
</span><a href="#local-6989586621679216440"><span class="hs-identifier hs-var">pV2</span></a></span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><a href="#local-6989586621679216392"><span class="hs-identifier hs-type">dir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-118"></span><span>      </span><span id="local-6989586621679216392"><span class="annot"><span class="annottext">dir :: V2 CInt -&gt; V2 DTime
</span><a href="#local-6989586621679216392"><span class="hs-identifier hs-var hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621679216391"><span class="annot"><span class="annottext">mV2 :: V2 CInt
</span><a href="#local-6989586621679216391"><span class="hs-identifier hs-var">mV2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 DTime -&gt; V2 DTime
forall a (f :: * -&gt; *).
(Floating a, Metric f, Epsilon a) =&gt;
f a -&gt; f a
</span><span class="hs-identifier hs-var">Linear.Metric.normalize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CInt -&gt; DTime) -&gt; V2 CInt -&gt; V2 DTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; DTime
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">V2 CInt
</span><a href="#local-6989586621679216391"><span class="hs-identifier hs-var">mV2</span></a></span><span> </span><span class="annot"><span class="annottext">V2 DTime -&gt; V2 DTime -&gt; V2 DTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">V2 DTime
</span><a href="#local-6989586621679216440"><span class="hs-identifier hs-var">pV2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><a href="#local-6989586621679216408"><span class="hs-identifier hs-type">lineEnd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621679216408"><span class="annot"><span class="annottext">lineEnd :: V2 CInt -&gt; V2 CInt
</span><a href="#local-6989586621679216408"><span class="hs-identifier hs-var hs-var">lineEnd</span></a></span></span><span> </span><span id="local-6989586621679216389"><span class="annot"><span class="annottext">mV2 :: V2 CInt
</span><a href="#local-6989586621679216389"><span class="hs-identifier hs-var">mV2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTime -&gt; CInt
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">(DTime -&gt; CInt) -&gt; V2 DTime -&gt; V2 CInt
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DTime -&gt; DTime -&gt; V2 DTime
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">DTime
</span><a href="#local-6989586621679216430"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span class="annot"><span class="annottext">DTime
</span><a href="#local-6989586621679216430"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span class="annot"><span class="annottext">V2 DTime -&gt; V2 DTime -&gt; V2 DTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">V2 CInt -&gt; V2 DTime
</span><a href="#local-6989586621679216392"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">V2 CInt
</span><a href="#local-6989586621679216389"><span class="hs-identifier hs-var">mV2</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621679216411"><span class="annot"><span class="annottext">drawObjs :: IO ()
</span><a href="#local-6989586621679216411"><span class="hs-identifier hs-var hs-var">drawObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><span class="hs-identifier hs-var">sequence_</span></span><span> </span><span class="annot"><span class="annottext">([IO ()] -&gt; IO ()) -&gt; [IO ()] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([IO ()] -&gt; (PointSize, PointSize) -&gt; GameObj -&gt; [IO ()])
-&gt; [IO ()] -&gt; ObjsMap -&gt; [IO ()]
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><span class="hs-identifier hs-var">Map.foldlWithKey</span></span><span>
</span><span id="line-122"></span><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679216386"><span class="annot"><span class="annottext">col :: [IO ()]
</span><a href="#local-6989586621679216386"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679216385"><span class="annot"><span class="annottext">posx :: PointSize
</span><a href="#local-6989586621679216385"><span class="hs-identifier hs-var">posx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679216384"><span class="annot"><span class="annottext">posy :: PointSize
</span><a href="#local-6989586621679216384"><span class="hs-identifier hs-var">posy</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216383"><span class="annot"><span class="annottext">gameobj :: GameObj
</span><a href="#local-6989586621679216383"><span class="hs-identifier hs-var">gameobj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Renderer
-&gt; Texture -&gt; Point V2 CInt -&gt; Maybe (Rectangle CInt) -&gt; IO ()
</span><a href="SDLWrapper.html#renderTexture"><span class="hs-identifier hs-var">renderTexture</span></a></span><span> </span><span class="annot"><span class="annottext">Renderer
</span><a href="#local-6989586621679216452"><span class="hs-identifier hs-var">renderer</span></a></span><span> </span><span class="annot"><span class="annottext">Texture
</span><a href="#local-6989586621679216451"><span class="hs-identifier hs-var">sheet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 CInt -&gt; Point V2 CInt
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">SDL.P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; V2 CInt
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PointSize -&gt; CInt
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">PointSize
</span><a href="#local-6989586621679216385"><span class="hs-identifier hs-var">posx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PointSize -&gt; CInt
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">PointSize
</span><a href="#local-6989586621679216384"><span class="hs-identifier hs-var">posy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rectangle CInt -&gt; Maybe (Rectangle CInt)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Rectangle CInt -&gt; Maybe (Rectangle CInt))
-&gt; Rectangle CInt -&gt; Maybe (Rectangle CInt)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GameObj -&gt; Rectangle CInt
</span><a href="Types.html#textureCoords"><span class="hs-identifier hs-var hs-var">textureCoords</span></a></span><span> </span><span class="annot"><span class="annottext">GameObj
</span><a href="#local-6989586621679216383"><span class="hs-identifier hs-var">gameobj</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">IO () -&gt; [IO ()] -&gt; [IO ()]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621679216386"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>                            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-124"></span><span>                            </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679216424"><span class="hs-identifier hs-var">objs</span></a></span></pre></body></html>