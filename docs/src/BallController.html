<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : BallController
Description : Brain of the game: ball signal function
-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE Arrows #-}</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">BallController</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">FRP.Yampa</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.VectorSpace</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Linear</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Linear.Metric</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C.Types</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">SDL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">($=)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Point</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Rectangle</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector3</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">FRP.Yampa.Delays</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">FRP.Yampa.Switches</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Parser.html"><span class="hs-identifier">Parser</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.html"><span class="hs-identifier">Types</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Utility.html"><span class="hs-identifier">Utility</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- |ballController is responsible for controlling ball state. </span><span>
</span><span id="line-30"></span><span class="hs-comment">-- It's one big SF which uses many other SFs defined in this module.</span><span>
</span><span id="line-31"></span><span class="annot"><a href="BallController.html#ballController"><span class="hs-identifier hs-type">ballController</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Ball"><span class="hs-identifier hs-type">Ball</span></a></span><span>                                </span><span class="hs-comment">-- ^ Initial ball</span><span>
</span><span id="line-32"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#GameInfo"><span class="hs-identifier hs-type">GameInfo</span></a></span><span>                             </span><span class="hs-comment">-- ^ Initial game state</span><span>
</span><span id="line-33"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameInput"><span class="hs-identifier hs-type">GameInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Types.html#GameOutput"><span class="hs-identifier hs-type">GameOutput</span></a></span><span>
</span><span id="line-34"></span><span id="ballController"><span class="annot"><span class="annottext">ballController :: Ball -&gt; GameInfo -&gt; SF (GameInput, ObjsMap) GameOutput
</span><a href="BallController.html#ballController"><span class="hs-identifier hs-var hs-var">ballController</span></a></span></span><span> </span><span id="local-6989586621679216065"><span class="annot"><span class="annottext">b :: Ball
</span><a href="#local-6989586621679216065"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Ball"><span class="hs-identifier hs-type">Ball</span></a></span><span> </span><span id="local-6989586621679216063"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679216063"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679216060"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679216060"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679216059"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679216059"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216058"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679216058"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679216057"><span class="annot"><span class="annottext">vx :: Double
</span><a href="#local-6989586621679216057"><span class="hs-identifier hs-var">vx</span></a></span></span><span> </span><span id="local-6989586621679216056"><span class="annot"><span class="annottext">vy :: Double
</span><a href="#local-6989586621679216056"><span class="hs-identifier hs-var">vy</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216055"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679216055"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679216054"><span class="annot"><span class="annottext">ax :: Double
</span><a href="#local-6989586621679216054"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621679216053"><span class="annot"><span class="annottext">ay :: Double
</span><a href="#local-6989586621679216053"><span class="hs-identifier hs-var">ay</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216052"><span class="annot"><span class="annottext">r :: Double
</span><a href="#local-6989586621679216052"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679216051"><span class="annot"><span class="annottext">pow :: Double
</span><a href="#local-6989586621679216051"><span class="hs-identifier hs-var">pow</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679216050"><span class="annot"><span class="annottext">gi :: GameInfo
</span><a href="#local-6989586621679216050"><span class="hs-identifier hs-var">gi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SF (GameInput, ObjsMap) (GameOutput, Event ())
-&gt; (() -&gt; SF (GameInput, ObjsMap) GameOutput)
-&gt; SF (GameInput, ObjsMap) GameOutput
forall a b c. SF a (b, Event c) -&gt; (c -&gt; SF a b) -&gt; SF a b
</span><span class="hs-identifier hs-var">switch</span></span><span> </span><span class="annot"><span class="annottext">SF (GameInput, ObjsMap) (GameOutput, Event ())
</span><a href="#local-6989586621679216048"><span class="hs-identifier hs-var">controller</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SF (GameInput, ObjsMap) GameOutput
-&gt; () -&gt; SF (GameInput, ObjsMap) GameOutput
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(SF (GameInput, ObjsMap) GameOutput
 -&gt; () -&gt; SF (GameInput, ObjsMap) GameOutput)
-&gt; SF (GameInput, ObjsMap) GameOutput
-&gt; ()
-&gt; SF (GameInput, ObjsMap) GameOutput
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ball -&gt; GameInfo -&gt; SF (GameInput, ObjsMap) GameOutput
</span><a href="BallController.html#ballController"><span class="hs-identifier hs-var">ballController</span></a></span><span> </span><span class="annot"><span class="annottext">Ball
</span><a href="#local-6989586621679216065"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">GameInfo
</span><a href="#local-6989586621679216050"><span class="hs-identifier hs-var">gi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>                </span><span class="annot"><a href="#local-6989586621679216048"><span class="hs-identifier hs-type">controller</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameInput"><span class="hs-identifier hs-type">GameInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameOutput"><span class="hs-identifier hs-type">GameOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>                </span><span id="local-6989586621679216048"><span class="annot"><span class="annottext">controller :: SF (GameInput, ObjsMap) (GameOutput, Event ())
</span><a href="#local-6989586621679216048"><span class="hs-identifier hs-var hs-var">controller</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679216046"><span class="annot"><span class="annottext">inp :: (GameInput, ObjsMap)
</span><a href="#local-6989586621679216046"><span class="hs-identifier hs-var">inp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679216045"><span class="annot"><span class="annottext">input :: GameInput
</span><a href="#local-6989586621679216045"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679216044"><span class="annot"><span class="annottext">objs :: ObjsMap
</span><a href="#local-6989586621679216044"><span class="hs-identifier hs-var">objs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-38"></span><span>                  </span><span id="local-6989586621679216043"><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679216043"><span class="hs-identifier hs-var">lmbReleased</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF GameInput (Event ())
</span><a href="Parser.html#mouseEventReleasedParser"><span class="hs-identifier hs-var">mouseEventReleasedParser</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">GameInput
</span><a href="#local-6989586621679216045"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-comment">-- determine whether we released LMB</span><span>
</span><span id="line-39"></span><span>                  </span><span id="local-6989586621679216041"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679216041"><span class="hs-identifier hs-var">nClicks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SF (Event (Int -&gt; Int)) Int
forall a. a -&gt; SF (Event (a -&gt; a)) a
</span><span class="hs-identifier hs-var">accumHold</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679216043"><span class="hs-identifier hs-var">lmbReleased</span></a></span><span> </span><span class="annot"><span class="annottext">Event () -&gt; (Int -&gt; Int) -&gt; Event (Int -&gt; Int)
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- count LMB clicks</span><span>
</span><span id="line-40"></span><span>                  </span><span id="local-6989586621679216037"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679216037"><span class="hs-identifier hs-var">qClicked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF GameInput (Event ())
</span><a href="Parser.html#qClickParser"><span class="hs-identifier hs-var">qClickParser</span></a></span><span> </span><span class="annot"><span class="annottext">SF GameInput (Event ()) -&gt; SF (Event ()) Bool -&gt; SF GameInput Bool
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Event () -&gt; Bool) -&gt; SF (Event ()) Bool
forall (a :: * -&gt; * -&gt; *) b c. Arrow a =&gt; (b -&gt; c) -&gt; a b c
</span><span class="hs-identifier hs-var">arr</span></span><span> </span><span class="annot"><span class="annottext">Event () -&gt; Bool
forall a. Event a -&gt; Bool
</span><span class="hs-identifier hs-var">isEvent</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">GameInput
</span><a href="#local-6989586621679216045"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-comment">-- determine whether we clicked Q</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>                  </span><span class="hs-comment">-- we have to use delayed switch so jumpPower isn't set to 0 after LMB release. If this happens, we can't really use it to shoot our ball.</span><span>
</span><span id="line-43"></span><span>                  </span><span id="local-6989586621679216033"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216033"><span class="hs-identifier hs-var">jumpPower</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-44"></span><span>                      </span><span class="annot"><span class="annottext">SF GameInput Double
-&gt; SF (GameInput, Event (SF GameInput Double)) Double
forall a b. SF a b -&gt; SF (a, Event (SF a b)) b
</span><span class="hs-identifier hs-var">drSwitch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SF GameInput Bool
</span><a href="Parser.html#mousePressedParser"><span class="hs-identifier hs-var">mousePressedParser</span></a></span><span> </span><span class="annot"><span class="annottext">SF GameInput Bool -&gt; SF Bool Double -&gt; SF GameInput Double
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; SF Bool Double
</span><a href="BallController.html#powerCalc"><span class="hs-identifier hs-var">powerCalc</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216051"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-45"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GameInput
</span><a href="#local-6989586621679216045"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679216043"><span class="hs-identifier hs-var">lmbReleased</span></a></span><span> </span><span class="annot"><span class="annottext">Event () -&gt; SF GameInput Double -&gt; Event (SF GameInput Double)
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SF GameInput Bool
</span><a href="Parser.html#mousePressedParser"><span class="hs-identifier hs-var">mousePressedParser</span></a></span><span> </span><span class="annot"><span class="annottext">SF GameInput Bool -&gt; SF Bool Double -&gt; SF GameInput Double
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; SF Bool Double
</span><a href="BallController.html#powerCalc"><span class="hs-identifier hs-var">powerCalc</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216051"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>                  </span><span id="local-6989586621679216029"><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679216029"><span class="hs-identifier hs-var">mPos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF GameInput (Point V2 Double)
</span><a href="Parser.html#mousePosParser"><span class="hs-identifier hs-var">mousePosParser</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">GameInput
</span><a href="#local-6989586621679216045"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-comment">-- determine mouse position</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>                  </span><span class="hs-keyword">rec</span><span> </span><span id="local-6989586621679216027"><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216027"><span class="hs-identifier hs-var">velModClick</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Event (Point V2 Double, Point V2 Double, Double)) (V2 Double)
</span><a href="BallController.html#clickSpeedModifier"><span class="hs-identifier hs-var">clickSpeedModifier</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679216043"><span class="hs-identifier hs-var">lmbReleased</span></a></span><span> </span><span class="annot"><span class="annottext">Event ()
-&gt; (Point V2 Double, Point V2 Double, Double)
-&gt; Event (Point V2 Double, Point V2 Double, Double)
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679216029"><span class="hs-identifier hs-var">mPos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double -&gt; Point V2 Double
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216025"><span class="hs-identifier hs-var">posX</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216024"><span class="hs-identifier hs-var">posY</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216033"><span class="hs-identifier hs-var">jumpPower</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- value of speed to switch into on LMB releasse</span><span>
</span><span id="line-49"></span><span>                      </span><span class="hs-comment">-- hitting an edge may change our velocity and acceleration. If we hit a floor and our velocity is very low, we start rolling on the ground.</span><span>
</span><span id="line-50"></span><span>                      </span><span class="hs-special">(</span><span id="local-6989586621679216023"><span class="annot"><span class="annottext">collisionEvent :: Event (GameObjType, HitDir)
</span><a href="#local-6989586621679216023"><span class="hs-identifier hs-var">collisionEvent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679216022"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679216022"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Event (GameObjType, HitDir), Bool)
-&gt; SF
     (Point V2 Double, V2 Double, Double, ObjsMap)
     (Event (GameObjType, HitDir), Bool)
-&gt; SF
     (Point V2 Double, V2 Double, Double, ObjsMap)
     (Event (GameObjType, HitDir), Bool)
forall b a. b -&gt; SF a b -&gt; SF a b
</span><span class="hs-identifier hs-var">fby</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
forall a. Event a
</span><span class="hs-identifier hs-var">NoEvent</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GameInfo
-&gt; SF
     (Point V2 Double, V2 Double, Double, ObjsMap)
     (Event (GameObjType, HitDir), Bool)
</span><a href="BallController.html#collisionChecker"><span class="hs-identifier hs-var">collisionChecker</span></a></span><span> </span><span class="annot"><span class="annottext">GameInfo
</span><a href="#local-6989586621679216050"><span class="hs-identifier hs-var">gi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 Double -&gt; Point V2 Double
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216025"><span class="hs-identifier hs-var">posX</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216024"><span class="hs-identifier hs-var">posY</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216018"><span class="hs-identifier hs-var">speed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216052"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679216044"><span class="hs-identifier hs-var">objs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>                      </span><span id="local-6989586621679216017"><span class="annot"><span class="annottext">(V2 Double, V2 Double)
</span><a href="#local-6989586621679216017"><span class="hs-identifier hs-var">velModHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF
  (Event ((GameObjType, HitDir), (V2 Double, V2 Double, Bool)))
  (V2 Double, V2 Double)
</span><a href="BallController.html#hitSAModifier"><span class="hs-identifier hs-var">hitSAModifier</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679216023"><span class="hs-identifier hs-var">collisionEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
-&gt; (V2 Double, V2 Double, Bool)
-&gt; Event ((GameObjType, HitDir), (V2 Double, V2 Double, Bool))
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216018"><span class="hs-identifier hs-var">speed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216014"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679216022"><span class="hs-identifier hs-var">rolling</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>                      </span><span class="hs-comment">-- every time we have click or edge hit event, we switch our speed-determining SF to a new one,</span><span>
</span><span id="line-53"></span><span>                      </span><span class="hs-comment">-- so it can make its calculation based on new parameters. We provide a parameter for this SF with a &quot;getTag&quot; function,</span><span>
</span><span id="line-54"></span><span>                      </span><span class="hs-comment">-- which processes click/edge hit events modified values and makes a new ball.</span><span>
</span><span id="line-55"></span><span>                      </span><span class="hs-special">(</span><span id="local-6989586621679216018"><span class="annot"><span class="annottext">speed :: V2 Double
</span><a href="#local-6989586621679216018"><span class="hs-identifier hs-var">speed</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679216013"><span class="annot"><span class="annottext">speedX :: Double
</span><a href="#local-6989586621679216013"><span class="hs-identifier hs-var">speedX</span></a></span></span><span> </span><span id="local-6989586621679216012"><span class="annot"><span class="annottext">speedY :: Double
</span><a href="#local-6989586621679216012"><span class="hs-identifier hs-var">speedY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679216014"><span class="annot"><span class="annottext">acc :: V2 Double
</span><a href="#local-6989586621679216014"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679216011"><span class="annot"><span class="annottext">accX :: Double
</span><a href="#local-6989586621679216011"><span class="hs-identifier hs-var">accX</span></a></span></span><span> </span><span id="local-6989586621679216010"><span class="annot"><span class="annottext">accY :: Double
</span><a href="#local-6989586621679216010"><span class="hs-identifier hs-var">accY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-56"></span><span>                          </span><span class="annot"><span class="annottext">(V2 Double, V2 Double)
-&gt; SF
     ((V2 Double, V2 Double, Bool),
      Event (SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double)))
     (V2 Double, V2 Double)
-&gt; SF
     ((V2 Double, V2 Double, Bool),
      Event (SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double)))
     (V2 Double, V2 Double)
forall b a. b -&gt; SF a b -&gt; SF a b
</span><span class="hs-identifier hs-var">fby</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="hs-number">0.0</span></span><span> </span><span class="annot"><span class="hs-number">0.0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="hs-number">0.0</span></span><span> </span><span class="annot"><span class="hs-number">0.0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double)
-&gt; SF
     ((V2 Double, V2 Double, Bool),
      Event (SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double)))
     (V2 Double, V2 Double)
forall a b. SF a b -&gt; SF (a, Event (SF a b)) b
</span><span class="hs-identifier hs-var">rSwitch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ball -&gt; SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double)
</span><a href="BallController.html#getVA"><span class="hs-identifier hs-var">getVA</span></a></span><span> </span><span class="annot"><span class="annottext">Ball
</span><a href="#local-6989586621679216065"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-57"></span><span>                          </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216018"><span class="hs-identifier hs-var">speed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216014"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679216022"><span class="hs-identifier hs-var">rolling</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>                            </span><span class="annot"><span class="annottext">Event () -&gt; Event () -&gt; Event ()
forall a. Event a -&gt; Event a -&gt; Event a
</span><span class="hs-identifier hs-var">lMerge</span></span><span> </span><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679216043"><span class="hs-identifier hs-var">lmbReleased</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679216023"><span class="hs-identifier hs-var">collisionEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir) -&gt; () -&gt; Event ()
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>                              </span><span class="annot"><span class="annottext">Event ()
-&gt; SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double)
-&gt; Event (SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double))
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="annot"><span class="annottext">Ball -&gt; SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double)
</span><a href="BallController.html#getVA"><span class="hs-identifier hs-var">getVA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event ()
-&gt; Event ()
-&gt; V2 Double
-&gt; (V2 Double, V2 Double)
-&gt; Point V2 Double
-&gt; V2 Double
-&gt; V2 Double
-&gt; Double
-&gt; Bool
-&gt; Ball
</span><a href="#local-6989586621679216006"><span class="hs-identifier hs-var">getTag</span></a></span><span> </span><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679216043"><span class="hs-identifier hs-var">lmbReleased</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679216023"><span class="hs-identifier hs-var">collisionEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir) -&gt; () -&gt; Event ()
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216027"><span class="hs-identifier hs-var">velModClick</span></a></span><span> </span><span class="annot"><span class="annottext">(V2 Double, V2 Double)
</span><a href="#local-6989586621679216017"><span class="hs-identifier hs-var">velModHit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 Double -&gt; Point V2 Double
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216025"><span class="hs-identifier hs-var">posX</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216024"><span class="hs-identifier hs-var">posY</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216018"><span class="hs-identifier hs-var">speed</span></a></span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216014"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216052"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679216022"><span class="hs-identifier hs-var">rolling</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>                      </span><span class="hs-comment">-- in next two lines we calculate ball position. It's just an integral over speed.</span><span>
</span><span id="line-61"></span><span>                      </span><span class="hs-comment">-- We switch to previous position on collision (we &quot;back off&quot; to position before collision)</span><span>
</span><span id="line-62"></span><span>                      </span><span id="local-6989586621679216025"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216025"><span class="hs-identifier hs-var">posX</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; SF (Double, Event (SF Double Double)) Double
forall a b. SF a b -&gt; SF (a, Event (SF a b)) b
</span><span class="hs-identifier hs-var">rSwitch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; SF Double Double
forall a. a -&gt; SF a a
</span><span class="hs-identifier hs-var">iPre</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216060"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; SF Double Double -&gt; SF Double Double
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double
forall a s. VectorSpace a s =&gt; SF a a
</span><span class="hs-identifier hs-var">integral</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; (Double -&gt; Double) -&gt; SF Double Double
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; (c -&gt; d) -&gt; a b d
</span><span class="hs-operator hs-var">&gt;&gt;^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216060"><span class="hs-identifier hs-var">px</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216013"><span class="hs-identifier hs-var">speedX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679216023"><span class="hs-identifier hs-var">collisionEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
-&gt; SF Double Double -&gt; Event (SF Double Double)
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SF Double Double
forall a s. VectorSpace a s =&gt; SF a a
</span><span class="hs-identifier hs-var">integral</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; (Double -&gt; Double) -&gt; SF Double Double
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; (c -&gt; d) -&gt; a b d
</span><span class="hs-operator hs-var">&gt;&gt;^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[V2 Double]
</span><a href="#local-6989586621679216002"><span class="hs-identifier hs-var">prevVals</span></a></span><span> </span><span class="annot"><span class="annottext">[V2 Double] -&gt; Int -&gt; V2 Double
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">V2 Double -&gt; Getting Double (V2 Double) Double -&gt; Double
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Double (V2 Double) Double
forall (t :: * -&gt; *) a. R1 t =&gt; Lens' (t a) a
</span><span class="hs-identifier hs-var">_x</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>                      </span><span id="local-6989586621679216024"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216024"><span class="hs-identifier hs-var">posY</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; SF (Double, Event (SF Double Double)) Double
forall a b. SF a b -&gt; SF (a, Event (SF a b)) b
</span><span class="hs-identifier hs-var">rSwitch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; SF Double Double
forall a. a -&gt; SF a a
</span><span class="hs-identifier hs-var">iPre</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216059"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; SF Double Double -&gt; SF Double Double
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double
forall a s. VectorSpace a s =&gt; SF a a
</span><span class="hs-identifier hs-var">integral</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; (Double -&gt; Double) -&gt; SF Double Double
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; (c -&gt; d) -&gt; a b d
</span><span class="hs-operator hs-var">&gt;&gt;^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216059"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216012"><span class="hs-identifier hs-var">speedY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679216023"><span class="hs-identifier hs-var">collisionEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
-&gt; SF Double Double -&gt; Event (SF Double Double)
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SF Double Double
forall a s. VectorSpace a s =&gt; SF a a
</span><span class="hs-identifier hs-var">integral</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; (Double -&gt; Double) -&gt; SF Double Double
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; (c -&gt; d) -&gt; a b d
</span><span class="hs-operator hs-var">&gt;&gt;^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[V2 Double]
</span><a href="#local-6989586621679216002"><span class="hs-identifier hs-var">prevVals</span></a></span><span> </span><span class="annot"><span class="annottext">[V2 Double] -&gt; Int -&gt; V2 Double
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">V2 Double -&gt; Getting Double (V2 Double) Double -&gt; Double
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Double (V2 Double) Double
forall (t :: * -&gt; *) a. R2 t =&gt; Lens' (t a) a
</span><span class="hs-identifier hs-var">_y</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>                      </span><span id="local-6989586621679215997"><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679215997"><span class="hs-identifier hs-var">eventLose</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Event (GameObjType, HitDir)) (Event ())
</span><a href="BallController.html#verifyLoseCondition"><span class="hs-identifier hs-var">verifyLoseCondition</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679216023"><span class="hs-identifier hs-var">collisionEvent</span></a></span><span>
</span><span id="line-65"></span><span>                      </span><span id="local-6989586621679215995"><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679215995"><span class="hs-identifier hs-var">eventWin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Event (GameObjType, HitDir)) (Event ())
</span><a href="BallController.html#verifyWinCondition"><span class="hs-identifier hs-var">verifyWinCondition</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679216023"><span class="hs-identifier hs-var">collisionEvent</span></a></span><span>
</span><span id="line-66"></span><span>                      </span><span id="local-6989586621679216002"><span class="annot"><span class="annottext">[V2 Double]
</span><a href="#local-6989586621679216002"><span class="hs-identifier hs-var">prevVals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[V2 Double]
-&gt; SF (Double, Double, [V2 Double]) [V2 Double]
-&gt; SF (Double, Double, [V2 Double]) [V2 Double]
forall b a. b -&gt; SF a b -&gt; SF a b
</span><span class="hs-identifier hs-var">fby</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216060"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216059"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216060"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216059"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216060"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216059"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SF (Double, Double, [V2 Double]) [V2 Double]
</span><a href="BallController.html#computePrevVals"><span class="hs-identifier hs-var">computePrevVals</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216025"><span class="hs-identifier hs-var">posX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216024"><span class="hs-identifier hs-var">posY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[V2 Double]
</span><a href="#local-6989586621679216002"><span class="hs-identifier hs-var">prevVals</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- here, we save previous position</span><span>
</span><span id="line-67"></span><span>                  </span><span id="local-6989586621679215992"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679215992"><span class="hs-identifier hs-var">retTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF GameInput Integer
</span><a href="Parser.html#timeParser"><span class="hs-identifier hs-var">timeParser</span></a></span><span>  </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">GameInput
</span><a href="#local-6989586621679216045"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-68"></span><span>                  </span><span class="annot"><span class="annottext">SF (GameOutput, Event ()) (GameOutput, Event ())
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GameOutput :: Ball
-&gt; Bool
-&gt; Int
-&gt; Bool
-&gt; Bool
-&gt; Int
-&gt; ObjsMap
-&gt; Integer
-&gt; GameOutput
</span><a href="Types.html#GameOutput"><span class="hs-identifier hs-type hs-type">GameOutput</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-69"></span><span>                              </span><span class="annot"><span class="annottext">ball :: Ball
</span><a href="Types.html#ball"><span class="hs-identifier hs-var">ball</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ball :: Point V2 Double
-&gt; V2 Double -&gt; V2 Double -&gt; Double -&gt; Double -&gt; Ball
</span><a href="Types.html#Ball"><span class="hs-identifier hs-type hs-type">Ball</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-70"></span><span>                                </span><span class="annot"><span class="annottext">position :: Point V2 Double
</span><a href="Types.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double -&gt; Point V2 Double
forall (f :: * -&gt; *) a. f a -&gt; Point f a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216025"><span class="hs-identifier hs-var">posX</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216024"><span class="hs-identifier hs-var">posY</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>                                </span><span class="annot"><span class="annottext">velocity :: V2 Double
</span><a href="Types.html#velocity"><span class="hs-identifier hs-var">velocity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216018"><span class="hs-identifier hs-var">speed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>                                </span><span class="annot"><span class="annottext">acceleration :: V2 Double
</span><a href="Types.html#acceleration"><span class="hs-identifier hs-var">acceleration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679216014"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>                                </span><span class="annot"><span class="annottext">radius :: Double
</span><a href="Types.html#radius"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216052"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>                                </span><span class="annot"><span class="annottext">power :: Double
</span><a href="Types.html#power"><span class="hs-identifier hs-var">power</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679216033"><span class="hs-identifier hs-var">jumpPower</span></a></span><span>
</span><span id="line-75"></span><span>                              </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>                              </span><span class="annot"><span class="annottext">shouldEnd :: Bool
</span><a href="Types.html#shouldEnd"><span class="hs-identifier hs-var">shouldEnd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679216037"><span class="hs-identifier hs-var">qClicked</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>                              </span><span class="annot"><span class="annottext">currTimeOut :: Integer
</span><a href="Types.html#currTimeOut"><span class="hs-identifier hs-var">currTimeOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679215992"><span class="hs-identifier hs-var">retTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>                              </span><span class="annot"><span class="annottext">nShots :: Int
</span><a href="Types.html#nShots"><span class="hs-identifier hs-var">nShots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679216041"><span class="hs-identifier hs-var">nClicks</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>                              </span><span class="annot"><span class="annottext">didWin :: Bool
</span><a href="Types.html#didWin"><span class="hs-identifier hs-var">didWin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event () -&gt; Bool
forall a. Event a -&gt; Bool
</span><span class="hs-identifier hs-var">isEvent</span></span><span> </span><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679215995"><span class="hs-identifier hs-var">eventWin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>                              </span><span class="annot"><span class="annottext">didFinishGame :: Bool
</span><a href="Types.html#didFinishGame"><span class="hs-identifier hs-var">didFinishGame</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>                              </span><span class="annot"><span class="annottext">outLvl :: Int
</span><a href="Types.html#outLvl"><span class="hs-identifier hs-var">outLvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>                              </span><span class="annot"><span class="annottext">objsMap :: ObjsMap
</span><a href="Types.html#objsMap"><span class="hs-identifier hs-var">objsMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679216044"><span class="hs-identifier hs-var">objs</span></a></span><span>
</span><span id="line-83"></span><span>                          </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679215997"><span class="hs-identifier hs-var">eventLose</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>                </span><span class="hs-comment">-- getTag is responsible for generating new ball info (velocity and acceleration) on discrete events (LMB clicks and collisions)</span><span>
</span><span id="line-85"></span><span>                </span><span class="hs-comment">-- getTag (clickEvent) (hitEvent) (clickEventModifiers) (hitEventModifiers) (position) (speed) (acceleration) (radius) (isRolling)</span><span>
</span><span id="line-86"></span><span>                </span><span class="annot"><a href="#local-6989586621679216006"><span class="hs-identifier hs-type">getTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#Ball"><span class="hs-identifier hs-type">Ball</span></a></span><span>
</span><span id="line-87"></span><span>                </span><span id="local-6989586621679216006"><span class="annot"><span class="annottext">getTag :: Event ()
-&gt; Event ()
-&gt; V2 Double
-&gt; (V2 Double, V2 Double)
-&gt; Point V2 Double
-&gt; V2 Double
-&gt; V2 Double
-&gt; Double
-&gt; Bool
-&gt; Ball
</span><a href="#local-6989586621679216006"><span class="hs-identifier hs-var hs-var">getTag</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoEvent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoEvent</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ball
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-comment">-- this cannot be called</span><span>
</span><span id="line-88"></span><span>                </span><span class="annot"><a href="#local-6989586621679216006"><span class="hs-identifier hs-var">getTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoEvent</span></span><span> </span><span id="local-6989586621679215971"><span class="annot"><span class="annottext">modC :: V2 Double
</span><a href="#local-6989586621679215971"><span class="hs-identifier hs-var">modC</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215970"><span class="annot"><span class="annottext">vx :: Double
</span><a href="#local-6989586621679215970"><span class="hs-identifier hs-var">vx</span></a></span></span><span> </span><span id="local-6989586621679215969"><span class="annot"><span class="annottext">vy :: Double
</span><a href="#local-6989586621679215969"><span class="hs-identifier hs-var">vy</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215968"><span class="annot"><span class="annottext">modH :: (V2 Double, V2 Double)
</span><a href="#local-6989586621679215968"><span class="hs-identifier hs-var">modH</span></a></span></span><span> </span><span id="local-6989586621679215967"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215967"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679215966"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215966"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679215965"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215965"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679215964"><span class="annot"><span class="annottext">r :: Double
</span><a href="#local-6989586621679215964"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679215963"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215963"><span class="hs-identifier hs-var">rolling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ball :: Point V2 Double
-&gt; V2 Double -&gt; V2 Double -&gt; Double -&gt; Double -&gt; Ball
</span><a href="Types.html#Ball"><span class="hs-identifier hs-type hs-type">Ball</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- after click</span><span>
</span><span id="line-89"></span><span>                                            </span><span class="annot"><span class="annottext">position :: Point V2 Double
</span><a href="Types.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215967"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>                                            </span><span class="annot"><span class="annottext">velocity :: V2 Double
</span><a href="Types.html#velocity"><span class="hs-identifier hs-var">velocity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215963"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215969"><span class="hs-identifier hs-var">vy</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215970"><span class="hs-identifier hs-var">vx</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215971"><span class="hs-identifier hs-var">modC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>                                            </span><span class="annot"><span class="annottext">acceleration :: V2 Double
</span><a href="Types.html#acceleration"><span class="hs-identifier hs-var">acceleration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215965"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>                                            </span><span class="annot"><span class="annottext">radius :: Double
</span><a href="Types.html#radius"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215964"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>                                            </span><span class="annot"><span class="annottext">power :: Double
</span><a href="Types.html#power"><span class="hs-identifier hs-var">power</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-94"></span><span>                                          </span><span class="hs-special">}</span><span>
</span><span id="line-95"></span><span>                </span><span class="annot"><a href="#local-6989586621679216006"><span class="hs-identifier hs-var">getTag</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoEvent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215960"><span class="annot"><span class="annottext">modC :: V2 Double
</span><a href="#local-6989586621679215960"><span class="hs-identifier hs-var">modC</span></a></span></span><span> </span><span id="local-6989586621679215959"><span class="annot"><span class="annottext">modH :: (V2 Double, V2 Double)
</span><a href="#local-6989586621679215959"><span class="hs-identifier hs-var">modH</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679215958"><span class="annot"><span class="annottext">modHv :: V2 Double
</span><a href="#local-6989586621679215958"><span class="hs-identifier hs-var">modHv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215957"><span class="annot"><span class="annottext">modHa :: V2 Double
</span><a href="#local-6989586621679215957"><span class="hs-identifier hs-var">modHa</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215956"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215956"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679215955"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215955"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679215954"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215954"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679215953"><span class="annot"><span class="annottext">r :: Double
</span><a href="#local-6989586621679215953"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679215952"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215952"><span class="hs-identifier hs-var">rolling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ball :: Point V2 Double
-&gt; V2 Double -&gt; V2 Double -&gt; Double -&gt; Double -&gt; Ball
</span><a href="Types.html#Ball"><span class="hs-identifier hs-type hs-type">Ball</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- after collision</span><span>
</span><span id="line-96"></span><span>                                            </span><span class="annot"><span class="annottext">position :: Point V2 Double
</span><a href="Types.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215956"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>                                            </span><span class="annot"><span class="annottext">velocity :: V2 Double
</span><a href="Types.html#velocity"><span class="hs-identifier hs-var">velocity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215958"><span class="hs-identifier hs-var">modHv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>                                            </span><span class="annot"><span class="annottext">acceleration :: V2 Double
</span><a href="Types.html#acceleration"><span class="hs-identifier hs-var">acceleration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215957"><span class="hs-identifier hs-var">modHa</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>                                            </span><span class="annot"><span class="annottext">radius :: Double
</span><a href="Types.html#radius"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215953"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>                                            </span><span class="annot"><span class="annottext">power :: Double
</span><a href="Types.html#power"><span class="hs-identifier hs-var">power</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-101"></span><span>                                          </span><span class="hs-special">}</span><span>
</span><span id="line-102"></span><span>                </span><span class="annot"><a href="#local-6989586621679216006"><span class="hs-identifier hs-var">getTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215951"><span class="annot"><span class="annottext">modC :: V2 Double
</span><a href="#local-6989586621679215951"><span class="hs-identifier hs-var">modC</span></a></span></span><span> </span><span id="local-6989586621679215950"><span class="annot"><span class="annottext">modH :: (V2 Double, V2 Double)
</span><a href="#local-6989586621679215950"><span class="hs-identifier hs-var">modH</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679215949"><span class="annot"><span class="annottext">modHv :: V2 Double
</span><a href="#local-6989586621679215949"><span class="hs-identifier hs-var">modHv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215948"><span class="annot"><span class="annottext">modHa :: V2 Double
</span><a href="#local-6989586621679215948"><span class="hs-identifier hs-var">modHa</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215947"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215947"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679215946"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215946"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679215945"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215945"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679215944"><span class="annot"><span class="annottext">r :: Double
</span><a href="#local-6989586621679215944"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679215943"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215943"><span class="hs-identifier hs-var">rolling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ball :: Point V2 Double
-&gt; V2 Double -&gt; V2 Double -&gt; Double -&gt; Double -&gt; Ball
</span><a href="Types.html#Ball"><span class="hs-identifier hs-type hs-type">Ball</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- this being called is highly unlikely</span><span>
</span><span id="line-103"></span><span>                                            </span><span class="annot"><span class="annottext">position :: Point V2 Double
</span><a href="Types.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215947"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>                                            </span><span class="annot"><span class="annottext">velocity :: V2 Double
</span><a href="Types.html#velocity"><span class="hs-identifier hs-var">velocity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215949"><span class="hs-identifier hs-var">modHv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>                                            </span><span class="annot"><span class="annottext">acceleration :: V2 Double
</span><a href="Types.html#acceleration"><span class="hs-identifier hs-var">acceleration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215948"><span class="hs-identifier hs-var">modHa</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>                                            </span><span class="annot"><span class="annottext">radius :: Double
</span><a href="Types.html#radius"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215944"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>                                            </span><span class="annot"><span class="annottext">power :: Double
</span><a href="Types.html#power"><span class="hs-identifier hs-var">power</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-108"></span><span>                                          </span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- |Our clicks should only modify velocity, based on ball position, player position and power given</span><span>
</span><span id="line-111"></span><span class="annot"><a href="BallController.html#clickSpeedModifier"><span class="hs-identifier hs-type">clickSpeedModifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span id="clickSpeedModifier"><span class="annot"><span class="annottext">clickSpeedModifier :: SF (Event (Point V2 Double, Point V2 Double, Double)) (V2 Double)
</span><a href="BallController.html#clickSpeedModifier"><span class="hs-identifier hs-var hs-var">clickSpeedModifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215942"><span class="annot"><span class="annottext">Event (Point V2 Double, Point V2 Double, Double)
</span><a href="#local-6989586621679215942"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Event (Point V2 Double, Point V2 Double, Double)
</span><a href="#local-6989586621679215942"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">NoEvent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SF (V2 Double) (V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span id="local-6989586621679215941"><span class="annot"><span class="annottext">mPos :: V2 Double
</span><a href="#local-6989586621679215941"><span class="hs-identifier hs-var">mPos</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span id="local-6989586621679215940"><span class="annot"><span class="annottext">pPos :: V2 Double
</span><a href="#local-6989586621679215940"><span class="hs-identifier hs-var">pPos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215939"><span class="annot"><span class="annottext">pow :: Double
</span><a href="#local-6989586621679215939"><span class="hs-identifier hs-var">pow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double) (V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215938"><span class="hs-identifier hs-var">velChange</span></a></span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>          </span><span id="local-6989586621679215937"><span class="annot"><span class="annottext">dir :: V2 Double
</span><a href="#local-6989586621679215937"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215936"><span class="annot"><span class="annottext">vx :: Double
</span><a href="#local-6989586621679215936"><span class="hs-identifier hs-var">vx</span></a></span></span><span> </span><span id="local-6989586621679215935"><span class="annot"><span class="annottext">vy :: Double
</span><a href="#local-6989586621679215935"><span class="hs-identifier hs-var">vy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">V2 Double -&gt; V2 Double
forall a (f :: * -&gt; *).
(Floating a, Metric f, Epsilon a) =&gt;
f a -&gt; f a
</span><span class="hs-identifier hs-var">Linear.Metric.normalize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215941"><span class="hs-identifier hs-var">mPos</span></a></span><span> </span><span class="annot"><span class="annottext">V2 Double -&gt; V2 Double -&gt; V2 Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215940"><span class="hs-identifier hs-var">pPos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- determine direction of movement</span><span>
</span><span id="line-119"></span><span>          </span><span id="local-6989586621679215938"><span class="annot"><span class="annottext">velChange :: V2 Double
</span><a href="#local-6989586621679215938"><span class="hs-identifier hs-var hs-var">velChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215939"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215939"><span class="hs-identifier hs-var">pow</span></a></span><span> </span><span class="annot"><span class="annottext">V2 Double -&gt; V2 Double -&gt; V2 Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215937"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="hs-comment">-- our new velocity vector has length of 50 in direction of mouse position</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- |hitSAModifier is a Hit Speed Acceleration Modifier. On collision we will change speed and acceleration.</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- For example, when we're rolling and friction works and we hit a wall, friction direction should change.</span><span>
</span><span id="line-123"></span><span class="annot"><a href="BallController.html#hitSAModifier"><span class="hs-identifier hs-type">hitSAModifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#HitDir"><span class="hs-identifier hs-type">HitDir</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span id="hitSAModifier"><span class="annot"><span class="annottext">hitSAModifier :: SF
  (Event ((GameObjType, HitDir), (V2 Double, V2 Double, Bool)))
  (V2 Double, V2 Double)
</span><a href="BallController.html#hitSAModifier"><span class="hs-identifier hs-var hs-var">hitSAModifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215932"><span class="annot"><span class="annottext">Event ((GameObjType, HitDir), (V2 Double, V2 Double, Bool))
</span><a href="#local-6989586621679215932"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Event ((GameObjType, HitDir), (V2 Double, V2 Double, Bool))
</span><a href="#local-6989586621679215932"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">NoEvent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Wall"><span class="hs-identifier hs-type">Wall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#UpSide"><span class="hs-identifier hs-type">UpSide</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215929"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215929"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215928"><span class="annot"><span class="annottext">vX :: Double
</span><a href="#local-6989586621679215928"><span class="hs-identifier hs-var">vX</span></a></span></span><span> </span><span id="local-6989586621679215927"><span class="annot"><span class="annottext">vY :: Double
</span><a href="#local-6989586621679215927"><span class="hs-identifier hs-var">vY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215926"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215926"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215925"><span class="annot"><span class="annottext">aX :: Double
</span><a href="#local-6989586621679215925"><span class="hs-identifier hs-var">aX</span></a></span></span><span> </span><span id="local-6989586621679215924"><span class="annot"><span class="annottext">aY :: Double
</span><a href="#local-6989586621679215924"><span class="hs-identifier hs-var">aY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215923"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215923"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>      </span><span class="hs-comment">-- if we hit a ground and our velocity is very low, we should stop. If we hit a ground and are now rolling, we should apply friction.</span><span>
</span><span id="line-130"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215928"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215927"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215927"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215927"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215927"><span class="hs-identifier hs-var">vY</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215923"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a p. (Ord a, Fractional p, Num a) =&gt; a -&gt; p
</span><a href="#local-6989586621679215920"><span class="hs-identifier hs-var">calculateXAcc</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215928"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215924"><span class="hs-identifier hs-var">aY</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215926"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Wall"><span class="hs-identifier hs-type">Wall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#DownSide"><span class="hs-identifier hs-type">DownSide</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215918"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215918"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215917"><span class="annot"><span class="annottext">vX :: Double
</span><a href="#local-6989586621679215917"><span class="hs-identifier hs-var">vX</span></a></span></span><span> </span><span id="local-6989586621679215916"><span class="annot"><span class="annottext">vY :: Double
</span><a href="#local-6989586621679215916"><span class="hs-identifier hs-var">vY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215915"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215915"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215914"><span class="annot"><span class="annottext">aX :: Double
</span><a href="#local-6989586621679215914"><span class="hs-identifier hs-var">aX</span></a></span></span><span> </span><span id="local-6989586621679215913"><span class="annot"><span class="annottext">aY :: Double
</span><a href="#local-6989586621679215913"><span class="hs-identifier hs-var">aY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215912"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215912"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>      </span><span class="hs-comment">-- if we hit a roof, we just bounce off of it</span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215917"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215916"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215915"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Wall"><span class="hs-identifier hs-type">Wall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#LeftSide"><span class="hs-identifier hs-type">LeftSide</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215910"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215910"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215909"><span class="annot"><span class="annottext">vX :: Double
</span><a href="#local-6989586621679215909"><span class="hs-identifier hs-var">vX</span></a></span></span><span> </span><span id="local-6989586621679215908"><span class="annot"><span class="annottext">vY :: Double
</span><a href="#local-6989586621679215908"><span class="hs-identifier hs-var">vY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215907"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215907"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215906"><span class="annot"><span class="annottext">aX :: Double
</span><a href="#local-6989586621679215906"><span class="hs-identifier hs-var">aX</span></a></span></span><span> </span><span id="local-6989586621679215905"><span class="annot"><span class="annottext">aY :: Double
</span><a href="#local-6989586621679215905"><span class="hs-identifier hs-var">aY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215904"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215904"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-comment">-- hitting left or right wall should change direction of X acceleration. This is used only for friction. </span><span>
</span><span id="line-139"></span><span>      </span><span class="hs-comment">-- Addition of other horizontal forces may change this.</span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215909"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215908"><span class="hs-identifier hs-var">vY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215906"><span class="hs-identifier hs-var">aX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215905"><span class="hs-identifier hs-var">aY</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Wall"><span class="hs-identifier hs-type">Wall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#RightSide"><span class="hs-identifier hs-type">RightSide</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215902"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215902"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215901"><span class="annot"><span class="annottext">vX :: Double
</span><a href="#local-6989586621679215901"><span class="hs-identifier hs-var">vX</span></a></span></span><span> </span><span id="local-6989586621679215900"><span class="annot"><span class="annottext">vY :: Double
</span><a href="#local-6989586621679215900"><span class="hs-identifier hs-var">vY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215899"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215899"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215898"><span class="annot"><span class="annottext">aX :: Double
</span><a href="#local-6989586621679215898"><span class="hs-identifier hs-var">aX</span></a></span></span><span> </span><span id="local-6989586621679215897"><span class="annot"><span class="annottext">aY :: Double
</span><a href="#local-6989586621679215897"><span class="hs-identifier hs-var">aY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215896"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215896"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215901"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215900"><span class="hs-identifier hs-var">vY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215898"><span class="hs-identifier hs-var">aX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215897"><span class="hs-identifier hs-var">aY</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- collision with corner should reverse both speed and acceleration. But we have to consider some edge cases.</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Wall"><span class="hs-identifier hs-type">Wall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#LeftDownSide"><span class="hs-identifier hs-type">LeftDownSide</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215894"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215894"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215893"><span class="annot"><span class="annottext">vX :: Double
</span><a href="#local-6989586621679215893"><span class="hs-identifier hs-var">vX</span></a></span></span><span> </span><span id="local-6989586621679215892"><span class="annot"><span class="annottext">vY :: Double
</span><a href="#local-6989586621679215892"><span class="hs-identifier hs-var">vY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215891"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215891"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215890"><span class="annot"><span class="annottext">aX :: Double
</span><a href="#local-6989586621679215890"><span class="hs-identifier hs-var">aX</span></a></span></span><span> </span><span id="local-6989586621679215889"><span class="annot"><span class="annottext">aY :: Double
</span><a href="#local-6989586621679215889"><span class="hs-identifier hs-var">aY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215888"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215888"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215893"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215893"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215892"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215891"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-148"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215892"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215893"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215892"><span class="hs-identifier hs-var">vY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215891"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215893"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215892"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215891"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Wall"><span class="hs-identifier hs-type">Wall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#RightDownSide"><span class="hs-identifier hs-type">RightDownSide</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215885"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215885"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215884"><span class="annot"><span class="annottext">vX :: Double
</span><a href="#local-6989586621679215884"><span class="hs-identifier hs-var">vX</span></a></span></span><span> </span><span id="local-6989586621679215883"><span class="annot"><span class="annottext">vY :: Double
</span><a href="#local-6989586621679215883"><span class="hs-identifier hs-var">vY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215882"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215882"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215881"><span class="annot"><span class="annottext">aX :: Double
</span><a href="#local-6989586621679215881"><span class="hs-identifier hs-var">aX</span></a></span></span><span> </span><span id="local-6989586621679215880"><span class="annot"><span class="annottext">aY :: Double
</span><a href="#local-6989586621679215880"><span class="hs-identifier hs-var">aY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215879"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215879"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215884"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215884"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215883"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215882"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-153"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215883"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215884"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215883"><span class="hs-identifier hs-var">vY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215882"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215884"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215883"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215882"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Wall"><span class="hs-identifier hs-type">Wall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#LeftUpSide"><span class="hs-identifier hs-type">LeftUpSide</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215877"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215877"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215876"><span class="annot"><span class="annottext">vX :: Double
</span><a href="#local-6989586621679215876"><span class="hs-identifier hs-var">vX</span></a></span></span><span> </span><span id="local-6989586621679215875"><span class="annot"><span class="annottext">vY :: Double
</span><a href="#local-6989586621679215875"><span class="hs-identifier hs-var">vY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215874"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215874"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215873"><span class="annot"><span class="annottext">aX :: Double
</span><a href="#local-6989586621679215873"><span class="hs-identifier hs-var">aX</span></a></span></span><span> </span><span id="local-6989586621679215872"><span class="annot"><span class="annottext">aY :: Double
</span><a href="#local-6989586621679215872"><span class="hs-identifier hs-var">aY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215871"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215871"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215871"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215877"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215874"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-158"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215876"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215876"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215875"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215874"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-159"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215875"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215876"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215875"><span class="hs-identifier hs-var">vY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215874"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215876"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215875"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215874"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Wall"><span class="hs-identifier hs-type">Wall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#RightUpSide"><span class="hs-identifier hs-type">RightUpSide</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215869"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215869"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215868"><span class="annot"><span class="annottext">vX :: Double
</span><a href="#local-6989586621679215868"><span class="hs-identifier hs-var">vX</span></a></span></span><span> </span><span id="local-6989586621679215867"><span class="annot"><span class="annottext">vY :: Double
</span><a href="#local-6989586621679215867"><span class="hs-identifier hs-var">vY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215866"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215866"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215865"><span class="annot"><span class="annottext">aX :: Double
</span><a href="#local-6989586621679215865"><span class="hs-identifier hs-var">aX</span></a></span></span><span> </span><span id="local-6989586621679215864"><span class="annot"><span class="annottext">aY :: Double
</span><a href="#local-6989586621679215864"><span class="hs-identifier hs-var">aY</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215863"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215863"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215863"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215869"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215866"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-164"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215868"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215868"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215867"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215866"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-165"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215867"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215868"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215867"><span class="hs-identifier hs-var">vY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215866"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215868"><span class="hs-identifier hs-var">vX</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215867"><span class="hs-identifier hs-var">vY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">0.6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215866"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679215920"><span class="annot"><span class="annottext">calculateXAcc :: a -&gt; p
</span><a href="#local-6989586621679215920"><span class="hs-identifier hs-var hs-var">calculateXAcc</span></a></span></span><span> </span><span id="local-6989586621679215862"><span class="annot"><span class="annottext">vX :: a
</span><a href="#local-6989586621679215862"><span class="hs-identifier hs-var">vX</span></a></span></span><span>
</span><span id="line-169"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679215862"><span class="hs-identifier hs-var">vX</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1.5</span></span><span>
</span><span id="line-170"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1.5</span></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">-- |powerCalc is supposed to calculate power of ball shot.</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- it just applies acc value to integral and switches, so we go back and forward</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- between 0 and 100 power value</span><span>
</span><span id="line-175"></span><span class="annot"><a href="BallController.html#powerCalc"><span class="hs-identifier hs-type">powerCalc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>           </span><span class="hs-comment">-- ^ Speed of power change</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>             </span><span class="hs-comment">-- ^ Initial power value (used for switching)</span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-178"></span><span id="powerCalc"><span class="annot"><span class="annottext">powerCalc :: Double -&gt; Double -&gt; SF Bool Double
</span><a href="BallController.html#powerCalc"><span class="hs-identifier hs-var hs-var">powerCalc</span></a></span></span><span> </span><span id="local-6989586621679215861"><span class="annot"><span class="annottext">s :: Double
</span><a href="#local-6989586621679215861"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679215860"><span class="annot"><span class="annottext">start :: Double
</span><a href="#local-6989586621679215860"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SF Bool (Double, Event Double)
-&gt; (Double -&gt; SF Bool Double) -&gt; SF Bool Double
forall a b c. SF a (b, Event c) -&gt; (c -&gt; SF a b) -&gt; SF a b
</span><span class="hs-identifier hs-var">switch</span></span><span> </span><span class="annot"><span class="annottext">SF Bool (Double, Event Double)
</span><a href="#local-6989586621679215859"><span class="hs-identifier hs-var">calc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; SF Bool Double
</span><a href="BallController.html#powerCalc"><span class="hs-identifier hs-var">powerCalc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215861"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679215859"><span class="annot"><span class="annottext">calc :: SF Bool (Double, Event Double)
</span><a href="#local-6989586621679215859"><span class="hs-identifier hs-var hs-var">calc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215858"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215858"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>      </span><span id="local-6989586621679215857"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215857"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF Double Double
forall a s. VectorSpace a s =&gt; SF a a
</span><span class="hs-identifier hs-var">integral</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; (Double -&gt; Double) -&gt; SF Double Double
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; (c -&gt; d) -&gt; a b d
</span><span class="hs-operator hs-var">&gt;&gt;^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215860"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215858"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215861"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-182"></span><span>      </span><span id="local-6989586621679215856"><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679215856"><span class="hs-identifier hs-var">should_switch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF Bool (Event ())
</span><span class="hs-identifier hs-var">edge</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215857"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">300</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215857"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><span class="annottext">SF (Double, Event Double) (Double, Event Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215857"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event ()
</span><a href="#local-6989586621679215856"><span class="hs-identifier hs-var">should_switch</span></a></span><span> </span><span class="annot"><span class="annottext">Event () -&gt; Double -&gt; Event Double
forall a b. Event a -&gt; b -&gt; Event b
</span><span class="hs-operator hs-var">`tag`</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215857"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- |computePrevVals updates our list of 3 recent positions</span><span>
</span><span id="line-186"></span><span class="annot"><a href="BallController.html#computePrevVals"><span class="hs-identifier hs-type">computePrevVals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-187"></span><span id="computePrevVals"><span class="annot"><span class="annottext">computePrevVals :: SF (Double, Double, [V2 Double]) [V2 Double]
</span><a href="BallController.html#computePrevVals"><span class="hs-identifier hs-var hs-var">computePrevVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215853"><span class="annot"><span class="annottext">input :: (Double, Double, [V2 Double])
</span><a href="#local-6989586621679215853"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679215852"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215852"><span class="hs-identifier hs-var">px</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215851"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215851"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215850"><span class="annot"><span class="annottext">valtabs :: [V2 Double]
</span><a href="#local-6989586621679215850"><span class="hs-identifier hs-var">valtabs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="annottext">SF [V2 Double] [V2 Double]
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215852"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215851"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[V2 Double] -&gt; V2 Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[V2 Double]
</span><a href="#local-6989586621679215850"><span class="hs-identifier hs-var">valtabs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[V2 Double]
</span><a href="#local-6989586621679215850"><span class="hs-identifier hs-var">valtabs</span></a></span><span> </span><span class="annot"><span class="annottext">[V2 Double] -&gt; Int -&gt; V2 Double
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- |getVA this is the most important SF: it is concerned with velocity. Our acceleration values are modified discretely, and our position value</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- is based only on velocity. Velocity values are changed in continuous and discrete manner (it changes all the time based on acceleration,</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- and it may change according to events). Discrete changes are implemented as rSwitch in ballController, and continuous changes are</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- implemented here.</span><span>
</span><span id="line-194"></span><span class="annot"><a href="BallController.html#getVA"><span class="hs-identifier hs-type">getVA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Ball"><span class="hs-identifier hs-type">Ball</span></a></span><span>                                                                                   </span><span class="hs-comment">-- ^ Ball data to use</span><span>
</span><span id="line-195"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>                                 </span><span class="hs-comment">-- ^ Resulting SF counting velocity and passing acceleration</span><span>
</span><span id="line-196"></span><span id="getVA"><span class="annot"><span class="annottext">getVA :: Ball -&gt; SF (V2 Double, V2 Double, Bool) (V2 Double, V2 Double)
</span><a href="BallController.html#getVA"><span class="hs-identifier hs-var hs-var">getVA</span></a></span></span><span> </span><span id="local-6989586621679215848"><span class="annot"><span class="annottext">b :: Ball
</span><a href="#local-6989586621679215848"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Ball"><span class="hs-identifier hs-type">Ball</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679215847"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215847"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215846"><span class="annot"><span class="annottext">vx :: Double
</span><a href="#local-6989586621679215846"><span class="hs-identifier hs-var">vx</span></a></span></span><span> </span><span id="local-6989586621679215845"><span class="annot"><span class="annottext">vy :: Double
</span><a href="#local-6989586621679215845"><span class="hs-identifier hs-var">vy</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215844"><span class="annot"><span class="annottext">a :: V2 Double
</span><a href="#local-6989586621679215844"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215843"><span class="annot"><span class="annottext">ax :: Double
</span><a href="#local-6989586621679215843"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621679215842"><span class="annot"><span class="annottext">ay :: Double
</span><a href="#local-6989586621679215842"><span class="hs-identifier hs-var">ay</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215841"><span class="annot"><span class="annottext">inp :: (V2 Double, V2 Double, Bool)
</span><a href="#local-6989586621679215841"><span class="hs-identifier hs-var">inp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679215840"><span class="annot"><span class="annottext">vi :: V2 Double
</span><a href="#local-6989586621679215840"><span class="hs-identifier hs-var">vi</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215839"><span class="annot"><span class="annottext">vxi :: Double
</span><a href="#local-6989586621679215839"><span class="hs-identifier hs-var">vxi</span></a></span></span><span> </span><span id="local-6989586621679215838"><span class="annot"><span class="annottext">vyi :: Double
</span><a href="#local-6989586621679215838"><span class="hs-identifier hs-var">vyi</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215837"><span class="annot"><span class="annottext">ai :: V2 Double
</span><a href="#local-6989586621679215837"><span class="hs-identifier hs-var">ai</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215836"><span class="annot"><span class="annottext">axi :: Double
</span><a href="#local-6989586621679215836"><span class="hs-identifier hs-var">axi</span></a></span></span><span> </span><span id="local-6989586621679215835"><span class="annot"><span class="annottext">ayi :: Double
</span><a href="#local-6989586621679215835"><span class="hs-identifier hs-var">ayi</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215834"><span class="annot"><span class="annottext">rolling :: Bool
</span><a href="#local-6989586621679215834"><span class="hs-identifier hs-var">rolling</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>            </span><span class="hs-comment">-- for now, I haven't modelled any kind of horizontal accelerations other than friction. If we're rolling and our horizontal velocity is very low,</span><span>
</span><span id="line-198"></span><span>            </span><span class="hs-comment">-- we should stop. If we're just rolling, we use given acceleration. Otherwise we have no horizontal acceleration and our X velocity doesn't</span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-comment">-- change.</span><span>
</span><span id="line-200"></span><span>            </span><span id="local-6989586621679215833"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215833"><span class="hs-identifier hs-var">speedX</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF Double Double
forall a s. VectorSpace a s =&gt; SF a a
</span><span class="hs-identifier hs-var">integral</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; (Double -&gt; Double) -&gt; SF Double Double
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; (c -&gt; d) -&gt; a b d
</span><span class="hs-operator hs-var">&gt;&gt;^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215846"><span class="hs-identifier hs-var">vx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215834"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215839"><span class="hs-identifier hs-var">vxi</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">1.0</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215834"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215843"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>            </span><span class="hs-comment">-- if we're rolling, we should not change our vertical velocity unless event happens. If we're not,</span><span>
</span><span id="line-203"></span><span>            </span><span class="hs-comment">-- we should just use gravitational acceleration.</span><span>
</span><span id="line-204"></span><span>            </span><span id="local-6989586621679215832"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215832"><span class="hs-identifier hs-var">speedY</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF Double Double
forall a s. VectorSpace a s =&gt; SF a a
</span><span class="hs-identifier hs-var">integral</span></span><span> </span><span class="annot"><span class="annottext">SF Double Double -&gt; (Double -&gt; Double) -&gt; SF Double Double
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; (c -&gt; d) -&gt; a b d
</span><span class="hs-operator hs-var">&gt;&gt;^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215845"><span class="hs-identifier hs-var">vy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679215834"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215835"><span class="hs-identifier hs-var">ayi</span></a></span><span>
</span><span id="line-205"></span><span>            </span><span class="annot"><span class="annottext">SF (V2 Double, V2 Double) (V2 Double, V2 Double)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; V2 Double
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215833"><span class="hs-identifier hs-var">speedX</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">1.0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215833"><span class="hs-identifier hs-var">speedX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215832"><span class="hs-identifier hs-var">speedY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">V2 Double
</span><a href="#local-6989586621679215844"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- |Check whether we collided with spikes</span><span>
</span><span id="line-208"></span><span class="annot"><a href="BallController.html#verifyLoseCondition"><span class="hs-identifier hs-type">verifyLoseCondition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#HitDir"><span class="hs-identifier hs-type">HitDir</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span id="verifyLoseCondition"><span class="annot"><span class="annottext">verifyLoseCondition :: SF (Event (GameObjType, HitDir)) (Event ())
</span><a href="BallController.html#verifyLoseCondition"><span class="hs-identifier hs-var hs-var">verifyLoseCondition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215831"><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679215831"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679215831"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">NoEvent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SF (Event ()) (Event ())
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Event ()
forall a. Event a
</span><span class="hs-identifier hs-var">NoEvent</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Spikes"><span class="hs-identifier hs-type">Spikes</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SF (Event ()) (Event ())
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Event ()
forall a. a -&gt; Event a
</span><span class="hs-identifier hs-var">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SF (Event ()) (Event ())
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Event ()
forall a. Event a
</span><span class="hs-identifier hs-var">NoEvent</span></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- |Check whether we collided with goal</span><span>
</span><span id="line-216"></span><span class="annot"><a href="BallController.html#verifyWinCondition"><span class="hs-identifier hs-type">verifyWinCondition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#HitDir"><span class="hs-identifier hs-type">HitDir</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span id="verifyWinCondition"><span class="annot"><span class="annottext">verifyWinCondition :: SF (Event (GameObjType, HitDir)) (Event ())
</span><a href="BallController.html#verifyWinCondition"><span class="hs-identifier hs-var hs-var">verifyWinCondition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215829"><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679215829"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Event (GameObjType, HitDir)
</span><a href="#local-6989586621679215829"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">NoEvent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SF (Event ()) (Event ())
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Event ()
forall a. Event a
</span><span class="hs-identifier hs-var">NoEvent</span></span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#Goal"><span class="hs-identifier hs-type">Goal</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SF (Event ()) (Event ())
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Event ()
forall a. a -&gt; Event a
</span><span class="hs-identifier hs-var">Event</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SF (Event ()) (Event ())
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Event ()
forall a. Event a
</span><span class="hs-identifier hs-var">NoEvent</span></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- |This SF filters far objects from ObjsMap given in input</span><span>
</span><span id="line-224"></span><span class="annot"><a href="BallController.html#filterFarObjectsSF"><span class="hs-identifier hs-type">filterFarObjectsSF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#GameInfo"><span class="hs-identifier hs-type">GameInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span>
</span><span id="line-225"></span><span id="filterFarObjectsSF"><span class="annot"><span class="annottext">filterFarObjectsSF :: GameInfo -&gt; SF (ObjsMap, Point V2 Int) ObjsMap
</span><a href="BallController.html#filterFarObjectsSF"><span class="hs-identifier hs-var hs-var">filterFarObjectsSF</span></a></span></span><span> </span><span id="local-6989586621679215826"><span class="annot"><span class="annottext">gi :: GameInfo
</span><a href="#local-6989586621679215826"><span class="hs-identifier hs-var">gi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215825"><span class="annot"><span class="annottext">input :: (ObjsMap, Point V2 Int)
</span><a href="#local-6989586621679215825"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679215824"><span class="annot"><span class="annottext">objs :: ObjsMap
</span><a href="#local-6989586621679215824"><span class="hs-identifier hs-var">objs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215823"><span class="annot"><span class="annottext">p :: Point V2 Int
</span><a href="#local-6989586621679215823"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><span class="annottext">SF ObjsMap ObjsMap
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">GameInfo -&gt; ObjsMap -&gt; Point V2 Int -&gt; ObjsMap
</span><a href="Utility.html#filterFarObjects"><span class="hs-identifier hs-var">filterFarObjects</span></a></span><span> </span><span class="annot"><span class="annottext">GameInfo
</span><a href="#local-6989586621679215826"><span class="hs-identifier hs-var">gi</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215824"><span class="hs-identifier hs-var">objs</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Int
</span><a href="#local-6989586621679215823"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- |collisionCalculator processes all objects from given ObjsMap and checks every edge for a</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- collision with current player position</span><span>
</span><span id="line-230"></span><span class="annot"><a href="BallController.html#collisionCalculator"><span class="hs-identifier hs-type">collisionCalculator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>                                               </span><span class="hs-comment">-- ^ Tile width and height</span><span>
</span><span id="line-231"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Types.html#CollisionEffect"><span class="hs-identifier hs-type">CollisionEffect</span></a></span><span>      </span><span class="hs-comment">-- ^ SF to count CollisionEffect</span><span>
</span><span id="line-232"></span><span id="collisionCalculator"><span class="annot"><span class="annottext">collisionCalculator :: (Int, Int) -&gt; SF (ObjsMap, Point V2 Double, Double) CollisionEffect
</span><a href="BallController.html#collisionCalculator"><span class="hs-identifier hs-var hs-var">collisionCalculator</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215820"><span class="annot"><span class="annottext">width :: Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215819"><span class="annot"><span class="annottext">height :: Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215818"><span class="annot"><span class="annottext">input :: (ObjsMap, Point V2 Double, Double)
</span><a href="#local-6989586621679215818"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679215817"><span class="annot"><span class="annottext">objsMap :: ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215816"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215815"><span class="annot"><span class="annottext">r :: Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="annottext">SF CollisionEffect CollisionEffect
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">CollisionEffect :: Maybe GameObjType
-&gt; Maybe GameObjType
-&gt; Maybe GameObjType
-&gt; Maybe GameObjType
-&gt; Maybe GameObjType
-&gt; Maybe GameObjType
-&gt; Maybe GameObjType
-&gt; Maybe GameObjType
-&gt; CollisionEffect
</span><a href="Types.html#CollisionEffect"><span class="hs-identifier hs-type hs-type">CollisionEffect</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">leftHitEffect :: Maybe GameObjType
</span><a href="Types.html#leftHitEffect"><span class="hs-identifier hs-var">leftHitEffect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215811"><span class="hs-identifier hs-var">checkLeftHit</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">rightHitEffect :: Maybe GameObjType
</span><a href="Types.html#rightHitEffect"><span class="hs-identifier hs-var">rightHitEffect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215809"><span class="hs-identifier hs-var">checkRightHit</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="annottext">upHitEffect :: Maybe GameObjType
</span><a href="Types.html#upHitEffect"><span class="hs-identifier hs-var">upHitEffect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215807"><span class="hs-identifier hs-var">checkUpHit</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="annottext">downHitEffect :: Maybe GameObjType
</span><a href="Types.html#downHitEffect"><span class="hs-identifier hs-var">downHitEffect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215805"><span class="hs-identifier hs-var">checkDownHit</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="annottext">leftUpHitEffect :: Maybe GameObjType
</span><a href="Types.html#leftUpHitEffect"><span class="hs-identifier hs-var">leftUpHitEffect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215803"><span class="hs-identifier hs-var">checkLeftUpHit</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="annottext">rightUpHitEffect :: Maybe GameObjType
</span><a href="Types.html#rightUpHitEffect"><span class="hs-identifier hs-var">rightUpHitEffect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215801"><span class="hs-identifier hs-var">checkRightUpHit</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">leftDownHitEffect :: Maybe GameObjType
</span><a href="Types.html#leftDownHitEffect"><span class="hs-identifier hs-var">leftDownHitEffect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215799"><span class="hs-identifier hs-var">checkLeftDownHit</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">rightDownHitEffect :: Maybe GameObjType
</span><a href="Types.html#rightDownHitEffect"><span class="hs-identifier hs-var">rightDownHitEffect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215797"><span class="hs-identifier hs-var">checkRightDownHit</span></a></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215816"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215815"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215817"><span class="hs-identifier hs-var">objsMap</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621679215796"><span class="annot"><span class="annottext">aggreg :: Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var hs-var">aggreg</span></a></span></span><span> </span><span id="local-6989586621679215795"><span class="annot"><span class="annottext">val :: Map k GameObj
</span><a href="#local-6989586621679215795"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GameObj -&gt; GameObjType) -&gt; Maybe GameObj -&gt; Maybe GameObjType
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">GameObj -&gt; GameObjType
</span><a href="Types.html#objType"><span class="hs-identifier hs-var hs-var">objType</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe GameObj -&gt; Maybe GameObjType)
-&gt; Maybe GameObj -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[GameObj] -&gt; Maybe GameObj
forall a. [a] -&gt; Maybe a
</span><a href="Utility.html#headMaybe"><span class="hs-identifier hs-var">headMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([GameObj] -&gt; Maybe GameObj) -&gt; [GameObj] -&gt; Maybe GameObj
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map k GameObj -&gt; [GameObj]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map k GameObj
</span><a href="#local-6989586621679215795"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-comment">-- every helper function takes ball postion, its radius and filtered ObjsMap.</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-comment">-- It then searches for GameObj for which collision coniditions are satisfied.</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-comment">-- There might be a collection of such objects so we take only first (it doesn't matter).</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="#local-6989586621679215811"><span class="hs-identifier hs-type">checkLeftHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621679215811"><span class="annot"><span class="annottext">checkLeftHit :: Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215811"><span class="hs-identifier hs-var hs-var">checkLeftHit</span></a></span></span><span> </span><span id="local-6989586621679215791"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215791"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215790"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215790"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679215789"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215789"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215788"><span class="annot"><span class="annottext">radius :: Double
</span><a href="#local-6989586621679215788"><span class="hs-identifier hs-var">radius</span></a></span></span><span> </span><span id="local-6989586621679215787"><span class="annot"><span class="annottext">filteredObjs :: ObjsMap
</span><a href="#local-6989586621679215787"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap -&gt; Maybe GameObjType
forall k. Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var">aggreg</span></a></span><span> </span><span class="annot"><span class="annottext">(ObjsMap -&gt; Maybe GameObjType) -&gt; ObjsMap -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; GameObj -&gt; Bool) -&gt; ObjsMap -&gt; ObjsMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679215785"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215785"><span class="hs-identifier hs-var">cpx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215784"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215784"><span class="hs-identifier hs-var">cpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215783"><span class="annot"><span class="annottext">go :: GameObj
</span><a href="#local-6989586621679215783"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>                                                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215790"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215785"><span class="hs-identifier hs-var">cpx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-251"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215789"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215784"><span class="hs-identifier hs-var">cpy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-252"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215789"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215784"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-253"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215788"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215785"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215790"><span class="hs-identifier hs-var">px</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215787"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><a href="#local-6989586621679215809"><span class="hs-identifier hs-type">checkRightHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621679215809"><span class="annot"><span class="annottext">checkRightHit :: Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215809"><span class="hs-identifier hs-var hs-var">checkRightHit</span></a></span></span><span> </span><span id="local-6989586621679215781"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215781"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215780"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215780"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679215779"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215779"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215778"><span class="annot"><span class="annottext">radius :: Double
</span><a href="#local-6989586621679215778"><span class="hs-identifier hs-var">radius</span></a></span></span><span> </span><span id="local-6989586621679215777"><span class="annot"><span class="annottext">filteredObjs :: ObjsMap
</span><a href="#local-6989586621679215777"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap -&gt; Maybe GameObjType
forall k. Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var">aggreg</span></a></span><span> </span><span class="annot"><span class="annottext">(ObjsMap -&gt; Maybe GameObjType) -&gt; ObjsMap -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; GameObj -&gt; Bool) -&gt; ObjsMap -&gt; ObjsMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679215776"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215776"><span class="hs-identifier hs-var">cpx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215775"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215775"><span class="hs-identifier hs-var">cpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215774"><span class="annot"><span class="annottext">go :: GameObj
</span><a href="#local-6989586621679215774"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>                                                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215780"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215776"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215779"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215775"><span class="hs-identifier hs-var">cpy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-258"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215779"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215775"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-259"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215778"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215780"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215776"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215777"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><a href="#local-6989586621679215807"><span class="hs-identifier hs-type">checkUpHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679215807"><span class="annot"><span class="annottext">checkUpHit :: Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215807"><span class="hs-identifier hs-var hs-var">checkUpHit</span></a></span></span><span> </span><span id="local-6989586621679215773"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215773"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215772"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215772"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679215771"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215771"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215770"><span class="annot"><span class="annottext">radius :: Double
</span><a href="#local-6989586621679215770"><span class="hs-identifier hs-var">radius</span></a></span></span><span> </span><span id="local-6989586621679215769"><span class="annot"><span class="annottext">filteredObjs :: ObjsMap
</span><a href="#local-6989586621679215769"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap -&gt; Maybe GameObjType
forall k. Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var">aggreg</span></a></span><span> </span><span class="annot"><span class="annottext">(ObjsMap -&gt; Maybe GameObjType) -&gt; ObjsMap -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; GameObj -&gt; Bool) -&gt; ObjsMap -&gt; ObjsMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679215768"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215768"><span class="hs-identifier hs-var">cpx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215767"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215767"><span class="hs-identifier hs-var">cpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215766"><span class="annot"><span class="annottext">go :: GameObj
</span><a href="#local-6989586621679215766"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>                                                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215771"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215767"><span class="hs-identifier hs-var">cpy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215772"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215768"><span class="hs-identifier hs-var">cpx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-264"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215772"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215768"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-265"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215770"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215767"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215771"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215769"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="#local-6989586621679215805"><span class="hs-identifier hs-type">checkDownHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679215805"><span class="annot"><span class="annottext">checkDownHit :: Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215805"><span class="hs-identifier hs-var hs-var">checkDownHit</span></a></span></span><span> </span><span id="local-6989586621679215765"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215765"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215764"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215764"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679215763"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215763"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215762"><span class="annot"><span class="annottext">radius :: Double
</span><a href="#local-6989586621679215762"><span class="hs-identifier hs-var">radius</span></a></span></span><span> </span><span id="local-6989586621679215761"><span class="annot"><span class="annottext">filteredObjs :: ObjsMap
</span><a href="#local-6989586621679215761"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap -&gt; Maybe GameObjType
forall k. Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var">aggreg</span></a></span><span> </span><span class="annot"><span class="annottext">(ObjsMap -&gt; Maybe GameObjType) -&gt; ObjsMap -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; GameObj -&gt; Bool) -&gt; ObjsMap -&gt; ObjsMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679215760"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215760"><span class="hs-identifier hs-var">cpx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215759"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215759"><span class="hs-identifier hs-var">cpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215758"><span class="annot"><span class="annottext">go :: GameObj
</span><a href="#local-6989586621679215758"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>                                                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215763"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215759"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-269"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215764"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215760"><span class="hs-identifier hs-var">cpx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215764"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215760"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215762"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215763"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215759"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215761"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><a href="#local-6989586621679215803"><span class="hs-identifier hs-type">checkLeftUpHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span id="local-6989586621679215803"><span class="annot"><span class="annottext">checkLeftUpHit :: Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215803"><span class="hs-identifier hs-var hs-var">checkLeftUpHit</span></a></span></span><span> </span><span id="local-6989586621679215757"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215757"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215756"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215756"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679215755"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215755"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215754"><span class="annot"><span class="annottext">radius :: Double
</span><a href="#local-6989586621679215754"><span class="hs-identifier hs-var">radius</span></a></span></span><span> </span><span id="local-6989586621679215753"><span class="annot"><span class="annottext">filteredObjs :: ObjsMap
</span><a href="#local-6989586621679215753"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap -&gt; Maybe GameObjType
forall k. Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var">aggreg</span></a></span><span> </span><span class="annot"><span class="annottext">(ObjsMap -&gt; Maybe GameObjType) -&gt; ObjsMap -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; GameObj -&gt; Bool) -&gt; ObjsMap -&gt; ObjsMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679215752"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215752"><span class="hs-identifier hs-var">cpx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215751"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215751"><span class="hs-identifier hs-var">cpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215750"><span class="annot"><span class="annottext">go :: GameObj
</span><a href="#local-6989586621679215750"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>                                                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215755"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215751"><span class="hs-identifier hs-var">cpy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215756"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215752"><span class="hs-identifier hs-var">cpx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-276"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215754"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215751"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215755"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Integer -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215752"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215756"><span class="hs-identifier hs-var">px</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Integer -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215753"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><a href="#local-6989586621679215801"><span class="hs-identifier hs-type">checkRightUpHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span id="local-6989586621679215801"><span class="annot"><span class="annottext">checkRightUpHit :: Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215801"><span class="hs-identifier hs-var hs-var">checkRightUpHit</span></a></span></span><span> </span><span id="local-6989586621679215747"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215747"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215746"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215746"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679215745"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215745"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215744"><span class="annot"><span class="annottext">radius :: Double
</span><a href="#local-6989586621679215744"><span class="hs-identifier hs-var">radius</span></a></span></span><span> </span><span id="local-6989586621679215743"><span class="annot"><span class="annottext">filteredObjs :: ObjsMap
</span><a href="#local-6989586621679215743"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap -&gt; Maybe GameObjType
forall k. Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var">aggreg</span></a></span><span> </span><span class="annot"><span class="annottext">(ObjsMap -&gt; Maybe GameObjType) -&gt; ObjsMap -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; GameObj -&gt; Bool) -&gt; ObjsMap -&gt; ObjsMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679215742"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215742"><span class="hs-identifier hs-var">cpx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215741"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215741"><span class="hs-identifier hs-var">cpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215740"><span class="annot"><span class="annottext">go :: GameObj
</span><a href="#local-6989586621679215740"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>                                                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215745"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215741"><span class="hs-identifier hs-var">cpy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215746"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215742"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215744"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215741"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215745"><span class="hs-identifier hs-var">py</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Integer -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215746"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215742"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Integer -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215743"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="#local-6989586621679215799"><span class="hs-identifier hs-type">checkLeftDownHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679215799"><span class="annot"><span class="annottext">checkLeftDownHit :: Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215799"><span class="hs-identifier hs-var hs-var">checkLeftDownHit</span></a></span></span><span> </span><span id="local-6989586621679215739"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215739"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215738"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215738"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679215737"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215737"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215736"><span class="annot"><span class="annottext">radius :: Double
</span><a href="#local-6989586621679215736"><span class="hs-identifier hs-var">radius</span></a></span></span><span> </span><span id="local-6989586621679215735"><span class="annot"><span class="annottext">filteredObjs :: ObjsMap
</span><a href="#local-6989586621679215735"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap -&gt; Maybe GameObjType
forall k. Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var">aggreg</span></a></span><span> </span><span class="annot"><span class="annottext">(ObjsMap -&gt; Maybe GameObjType) -&gt; ObjsMap -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; GameObj -&gt; Bool) -&gt; ObjsMap -&gt; ObjsMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679215734"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215734"><span class="hs-identifier hs-var">cpx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215733"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215733"><span class="hs-identifier hs-var">cpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215732"><span class="annot"><span class="annottext">go :: GameObj
</span><a href="#local-6989586621679215732"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>                                                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215737"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215733"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-285"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215738"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215734"><span class="hs-identifier hs-var">cpx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-286"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215736"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215737"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215733"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Integer -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215734"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215738"><span class="hs-identifier hs-var">px</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Integer -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215735"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><a href="#local-6989586621679215797"><span class="hs-identifier hs-type">checkRightDownHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621679215797"><span class="annot"><span class="annottext">checkRightDownHit :: Point V2 Double -&gt; Double -&gt; ObjsMap -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215797"><span class="hs-identifier hs-var hs-var">checkRightDownHit</span></a></span></span><span> </span><span id="local-6989586621679215731"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215731"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215730"><span class="annot"><span class="annottext">px :: Double
</span><a href="#local-6989586621679215730"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679215729"><span class="annot"><span class="annottext">py :: Double
</span><a href="#local-6989586621679215729"><span class="hs-identifier hs-var">py</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215728"><span class="annot"><span class="annottext">radius :: Double
</span><a href="#local-6989586621679215728"><span class="hs-identifier hs-var">radius</span></a></span></span><span> </span><span id="local-6989586621679215727"><span class="annot"><span class="annottext">filteredObjs :: ObjsMap
</span><a href="#local-6989586621679215727"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjsMap -&gt; Maybe GameObjType
forall k. Map k GameObj -&gt; Maybe GameObjType
</span><a href="#local-6989586621679215796"><span class="hs-identifier hs-var">aggreg</span></a></span><span> </span><span class="annot"><span class="annottext">(ObjsMap -&gt; Maybe GameObjType) -&gt; ObjsMap -&gt; Maybe GameObjType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; GameObj -&gt; Bool) -&gt; ObjsMap -&gt; ObjsMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679215726"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215726"><span class="hs-identifier hs-var">cpx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215725"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215725"><span class="hs-identifier hs-var">cpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215724"><span class="annot"><span class="annottext">go :: GameObj
</span><a href="#local-6989586621679215724"><span class="hs-identifier hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>                                                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215729"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215725"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-290"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215730"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215726"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-291"></span><span>                                                                      </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215728"><span class="hs-identifier hs-var">radius</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215729"><span class="hs-identifier hs-var">py</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215725"><span class="hs-identifier hs-var">cpy</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215819"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Integer -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215730"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215726"><span class="hs-identifier hs-var">cpx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679215820"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">Double -&gt; Integer -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215727"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- |collisionChecker is responsible for generating informations on collisions. It uses </span><span>
</span><span id="line-294"></span><span class="hs-comment">-- collisionCalculator to calculate collisions. Beside generating event on collision,</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- it gives us continuous info whether we're rolling</span><span>
</span><span id="line-296"></span><span class="annot"><a href="BallController.html#collisionChecker"><span class="hs-identifier hs-type">collisionChecker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#GameInfo"><span class="hs-identifier hs-type">GameInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>                                                                             </span><span>
</span><span id="line-297"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">SF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#ObjsMap"><span class="hs-identifier hs-type">ObjsMap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Event</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameObjType"><span class="hs-identifier hs-type">GameObjType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#HitDir"><span class="hs-identifier hs-type">HitDir</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>        </span><span>
</span><span id="line-298"></span><span id="collisionChecker"><span class="annot"><span class="annottext">collisionChecker :: GameInfo
-&gt; SF
     (Point V2 Double, V2 Double, Double, ObjsMap)
     (Event (GameObjType, HitDir), Bool)
</span><a href="BallController.html#collisionChecker"><span class="hs-identifier hs-var hs-var">collisionChecker</span></a></span></span><span> </span><span id="local-6989586621679215723"><span class="annot"><span class="annottext">gi :: GameInfo
</span><a href="#local-6989586621679215723"><span class="hs-identifier hs-var">gi</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#GameInfo"><span class="hs-identifier hs-type">GameInfo</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679215721"><span class="annot"><span class="annottext">width :: CInt
</span><a href="#local-6989586621679215721"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679215720"><span class="annot"><span class="annottext">height :: CInt
</span><a href="#local-6989586621679215720"><span class="hs-identifier hs-var">height</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span id="local-6989586621679215719"><span class="annot"><span class="annottext">input :: (Point V2 Double, V2 Double, Double, ObjsMap)
</span><a href="#local-6989586621679215719"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679215718"><span class="annot"><span class="annottext">p :: Point V2 Double
</span><a href="#local-6989586621679215718"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215717"><span class="annot"><span class="annottext">v :: V2 Double
</span><a href="#local-6989586621679215717"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621679215716"><span class="annot"><span class="annottext">vx :: Double
</span><a href="#local-6989586621679215716"><span class="hs-identifier hs-var">vx</span></a></span></span><span> </span><span id="local-6989586621679215715"><span class="annot"><span class="annottext">vy :: Double
</span><a href="#local-6989586621679215715"><span class="hs-identifier hs-var">vy</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215714"><span class="annot"><span class="annottext">r :: Double
</span><a href="#local-6989586621679215714"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679215713"><span class="annot"><span class="annottext">objsMap :: ObjsMap
</span><a href="#local-6989586621679215713"><span class="hs-identifier hs-var">objsMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>  </span><span id="local-6989586621679215712"><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215712"><span class="hs-identifier hs-var">filteredObjs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GameInfo -&gt; SF (ObjsMap, Point V2 Int) ObjsMap
</span><a href="BallController.html#filterFarObjectsSF"><span class="hs-identifier hs-var">filterFarObjectsSF</span></a></span><span> </span><span class="annot"><span class="annottext">GameInfo
</span><a href="#local-6989586621679215723"><span class="hs-identifier hs-var">gi</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215713"><span class="hs-identifier hs-var">objsMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Int) -&gt; Point V2 Double -&gt; Point V2 Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215718"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- we filter out far objects</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621679215710"><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; SF (ObjsMap, Point V2 Double, Double) CollisionEffect
</span><a href="BallController.html#collisionCalculator"><span class="hs-identifier hs-var">collisionCalculator</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679215721"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679215720"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ObjsMap
</span><a href="#local-6989586621679215712"><span class="hs-identifier hs-var">filteredObjs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point V2 Double
</span><a href="#local-6989586621679215718"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215714"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- we generate CollisionEffect</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-comment">-- for each of 4 walls, we want to generate event on rising edge of wall hit</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679215709"><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215709"><span class="hs-identifier hs-var">leftHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Maybe GameObjType) (Event GameObjType)
forall a. SF (Maybe a) (Event a)
</span><span class="hs-identifier hs-var">edgeJust</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#leftHitEffect"><span class="hs-identifier hs-var hs-var">leftHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span>
</span><span id="line-303"></span><span>  </span><span id="local-6989586621679215707"><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215707"><span class="hs-identifier hs-var">rightHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Maybe GameObjType) (Event GameObjType)
forall a. SF (Maybe a) (Event a)
</span><span class="hs-identifier hs-var">edgeJust</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#rightHitEffect"><span class="hs-identifier hs-var hs-var">rightHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621679215706"><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215706"><span class="hs-identifier hs-var">upHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Maybe GameObjType) (Event GameObjType)
forall a. SF (Maybe a) (Event a)
</span><span class="hs-identifier hs-var">edgeJust</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#upHitEffect"><span class="hs-identifier hs-var hs-var">upHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span id="local-6989586621679215705"><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215705"><span class="hs-identifier hs-var">downHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Maybe GameObjType) (Event GameObjType)
forall a. SF (Maybe a) (Event a)
</span><span class="hs-identifier hs-var">edgeJust</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#downHitEffect"><span class="hs-identifier hs-var hs-var">downHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-comment">-- for each of 4 corners, we want to SKIP event if we're already colliding with a wall or rolling.</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-comment">-- otherwise, we generate event on rising edge</span><span>
</span><span id="line-308"></span><span>  </span><span id="local-6989586621679215704"><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215704"><span class="hs-identifier hs-var">leftUpHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Maybe GameObjType) (Event GameObjType)
forall a. SF (Maybe a) (Event a)
</span><span class="hs-identifier hs-var">edgeJust</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Bool
</span><a href="#local-6989586621679215703"><span class="hs-identifier hs-var">sideHit</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Double -&gt; Bool
</span><a href="#local-6989586621679215702"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215715"><span class="hs-identifier hs-var">vy</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe GameObjType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#leftUpHitEffect"><span class="hs-identifier hs-var hs-var">leftUpHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621679215701"><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215701"><span class="hs-identifier hs-var">rightUpHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Maybe GameObjType) (Event GameObjType)
forall a. SF (Maybe a) (Event a)
</span><span class="hs-identifier hs-var">edgeJust</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Bool
</span><a href="#local-6989586621679215703"><span class="hs-identifier hs-var">sideHit</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Double -&gt; Bool
</span><a href="#local-6989586621679215702"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215715"><span class="hs-identifier hs-var">vy</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe GameObjType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#rightUpHitEffect"><span class="hs-identifier hs-var hs-var">rightUpHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621679215700"><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215700"><span class="hs-identifier hs-var">leftDownHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Maybe GameObjType) (Event GameObjType)
forall a. SF (Maybe a) (Event a)
</span><span class="hs-identifier hs-var">edgeJust</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Bool
</span><a href="#local-6989586621679215703"><span class="hs-identifier hs-var">sideHit</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Double -&gt; Bool
</span><a href="#local-6989586621679215702"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215715"><span class="hs-identifier hs-var">vy</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe GameObjType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#leftDownHitEffect"><span class="hs-identifier hs-var hs-var">leftDownHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span id="local-6989586621679215699"><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215699"><span class="hs-identifier hs-var">rightDownHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SF (Maybe GameObjType) (Event GameObjType)
forall a. SF (Maybe a) (Event a)
</span><span class="hs-identifier hs-var">edgeJust</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Bool
</span><a href="#local-6989586621679215703"><span class="hs-identifier hs-var">sideHit</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Double -&gt; Bool
</span><a href="#local-6989586621679215702"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215715"><span class="hs-identifier hs-var">vy</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe GameObjType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#rightDownHitEffect"><span class="hs-identifier hs-var hs-var">rightDownHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- we are said to be &quot;rolling&quot; when we're colliding with upper part of collider and our vertical velocity is very low</span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><span class="annottext">SF
  (Event (GameObjType, HitDir), Bool)
  (Event (GameObjType, HitDir), Bool)
forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><span class="hs-identifier hs-var">returnA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Event (GameObjType, HitDir)] -&gt; Event (GameObjType, HitDir)
forall a. [Event a] -&gt; Event a
</span><span class="hs-identifier hs-var">mergeEvents</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215706"><span class="hs-identifier hs-var">upHit</span></a></span><span> </span><span class="annot"><span class="annottext">Event GameObjType -&gt; HitDir -&gt; Event (GameObjType, HitDir)
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="annot"><span class="annottext">HitDir
</span><a href="Types.html#UpSide"><span class="hs-identifier hs-var">UpSide</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215705"><span class="hs-identifier hs-var">downHit</span></a></span><span> </span><span class="annot"><span class="annottext">Event GameObjType -&gt; HitDir -&gt; Event (GameObjType, HitDir)
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="annot"><span class="annottext">HitDir
</span><a href="Types.html#DownSide"><span class="hs-identifier hs-var">DownSide</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-314"></span><span>                          </span><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215707"><span class="hs-identifier hs-var">rightHit</span></a></span><span> </span><span class="annot"><span class="annottext">Event GameObjType -&gt; HitDir -&gt; Event (GameObjType, HitDir)
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="annot"><span class="annottext">HitDir
</span><a href="Types.html#RightSide"><span class="hs-identifier hs-var">RightSide</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215709"><span class="hs-identifier hs-var">leftHit</span></a></span><span> </span><span class="annot"><span class="annottext">Event GameObjType -&gt; HitDir -&gt; Event (GameObjType, HitDir)
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="annot"><span class="annottext">HitDir
</span><a href="Types.html#LeftSide"><span class="hs-identifier hs-var">LeftSide</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-315"></span><span>                          </span><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215704"><span class="hs-identifier hs-var">leftUpHit</span></a></span><span> </span><span class="annot"><span class="annottext">Event GameObjType -&gt; HitDir -&gt; Event (GameObjType, HitDir)
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="annot"><span class="annottext">HitDir
</span><a href="Types.html#LeftUpSide"><span class="hs-identifier hs-var">LeftUpSide</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215701"><span class="hs-identifier hs-var">rightUpHit</span></a></span><span> </span><span class="annot"><span class="annottext">Event GameObjType -&gt; HitDir -&gt; Event (GameObjType, HitDir)
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="annot"><span class="annottext">HitDir
</span><a href="Types.html#RightUpSide"><span class="hs-identifier hs-var">RightUpSide</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-316"></span><span>                          </span><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215700"><span class="hs-identifier hs-var">leftDownHit</span></a></span><span> </span><span class="annot"><span class="annottext">Event GameObjType -&gt; HitDir -&gt; Event (GameObjType, HitDir)
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="annot"><span class="annottext">HitDir
</span><a href="Types.html#LeftDownSide"><span class="hs-identifier hs-var">LeftDownSide</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Event GameObjType
</span><a href="#local-6989586621679215699"><span class="hs-identifier hs-var">rightDownHit</span></a></span><span> </span><span class="annot"><span class="annottext">Event GameObjType -&gt; HitDir -&gt; Event (GameObjType, HitDir)
forall a b. Event a -&gt; b -&gt; Event (a, b)
</span><span class="hs-operator hs-var">`attach`</span></span><span> </span><span class="annot"><span class="annottext">HitDir
</span><a href="Types.html#RightDownSide"><span class="hs-identifier hs-var">RightDownSide</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>                          </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Double -&gt; Bool
</span><a href="#local-6989586621679215702"><span class="hs-identifier hs-var">rolling</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215710"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215715"><span class="hs-identifier hs-var">vy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="#local-6989586621679215703"><span class="hs-identifier hs-type">sideHit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#CollisionEffect"><span class="hs-identifier hs-type">CollisionEffect</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621679215703"><span class="annot"><span class="annottext">sideHit :: CollisionEffect -&gt; Bool
</span><a href="#local-6989586621679215703"><span class="hs-identifier hs-var hs-var">sideHit</span></a></span></span><span> </span><span id="local-6989586621679215697"><span class="annot"><span class="annottext">colls :: CollisionEffect
</span><a href="#local-6989586621679215697"><span class="hs-identifier hs-var">colls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe GameObjType -&gt; Bool) -&gt; [Maybe GameObjType] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Maybe GameObjType -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#leftHitEffect"><span class="hs-identifier hs-var hs-var">leftHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215697"><span class="hs-identifier hs-var">colls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#rightHitEffect"><span class="hs-identifier hs-var hs-var">rightHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215697"><span class="hs-identifier hs-var">colls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#upHitEffect"><span class="hs-identifier hs-var hs-var">upHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215697"><span class="hs-identifier hs-var">colls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#downHitEffect"><span class="hs-identifier hs-var hs-var">downHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215697"><span class="hs-identifier hs-var">colls</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><a href="#local-6989586621679215702"><span class="hs-identifier hs-type">rolling</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#CollisionEffect"><span class="hs-identifier hs-type">CollisionEffect</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621679215702"><span class="annot"><span class="annottext">rolling :: CollisionEffect -&gt; Double -&gt; Bool
</span><a href="#local-6989586621679215702"><span class="hs-identifier hs-var hs-var">rolling</span></a></span></span><span> </span><span id="local-6989586621679215694"><span class="annot"><span class="annottext">collisionEffects :: CollisionEffect
</span><a href="#local-6989586621679215694"><span class="hs-identifier hs-var">collisionEffects</span></a></span></span><span> </span><span id="local-6989586621679215693"><span class="annot"><span class="annottext">vy :: Double
</span><a href="#local-6989586621679215693"><span class="hs-identifier hs-var">vy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GameObjType -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GameObjType -&gt; Bool) -&gt; Maybe GameObjType -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#upHitEffect"><span class="hs-identifier hs-var hs-var">upHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215694"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GameObjType -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GameObjType -&gt; Bool) -&gt; Maybe GameObjType -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#leftUpHitEffect"><span class="hs-identifier hs-var hs-var">leftUpHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215694"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GameObjType -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe GameObjType -&gt; Bool) -&gt; Maybe GameObjType -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CollisionEffect -&gt; Maybe GameObjType
</span><a href="Types.html#rightUpHitEffect"><span class="hs-identifier hs-var hs-var">rightUpHitEffect</span></a></span><span> </span><span class="annot"><span class="annottext">CollisionEffect
</span><a href="#local-6989586621679215694"><span class="hs-identifier hs-var">collisionEffects</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679215693"><span class="hs-identifier hs-var">vy</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span class="hs-special">)</span></pre></body></html>